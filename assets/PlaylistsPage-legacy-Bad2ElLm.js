System.register(["./ConfirmModal-legacy-CnRD7ob6.js","./ModalComponent-legacy-BmTvlHoT.js","./CreatePlaylistModal-legacy-Bg0tm0yq.js","./index-legacy-CmTDz3X_.js"],(function(l,t){"use strict";var e,s,i,a,o,n,r,d,c,y,p,u,m,h,b,f,k,P,w;return{setters:[l=>{e=l.C},l=>{s=l.M},l=>{i=l.C},l=>{a=l.a,o=l.c,n=l.w,r=l.b,d=l.j,c=l.F,y=l.f,p=l.g,u=l.r,m=l.o,h=l.d,b=l.e,f=l.t,k=l.l,P=l.y,w=l.h}],execute:function(){const t={components:{ConfirmModal:e,ModalComponent:s,CreatePlaylistModal:i},data:()=>({playlists:[],bookmarks:[],playlistToDelete:null,playlistToEdit:null,newPlaylistName:"",newPlaylistDescription:"",showCreatePlaylistModal:!1}),mounted(){this.fetchPlaylists(),this.loadPlaylistBookmarks()},activated(){document.title=this.$t("titles.playlists")+" - Piped"},methods:{fetchPlaylists(){this.getPlaylists().then((l=>{this.playlists=l}))},showPlaylistEditModal(l){this.newPlaylistName=l.name,this.newPlaylistDescription=l.description,this.playlistToEdit=l.id},editPlaylist(l){const t=this.newPlaylistName,e=this.newPlaylistDescription;t!=l.name&&this.renamePlaylist(l.id,t).then((e=>{e.error?alert(e.error):l.name=t})),e!=l.description&&this.changePlaylistDescription(l.id,e).then((t=>{t.error?alert(t.error):l.description=e})),this.playlistToEdit=null},onDeletePlaylist(l){this.deletePlaylist(l).then((t=>{t.error?alert(t.error):this.playlists=this.playlists.filter((t=>t.id!==l))})),this.playlistToDelete=null},async exportPlaylists(){if(!this.playlists)return;let l={format:"Piped",version:1,playlists:[]},t=this.playlists.map((l=>this.fetchPlaylistJson(l.id)));l.playlists=await Promise.all(t),this.download(JSON.stringify(l),"playlists.json","application/json")},async fetchPlaylistJson(l){let t=await this.getPlaylist(l);return{name:t.name,type:"playlist",visibility:"private",videos:t.relatedStreams.map((l=>"https://youtube.com"+l.url))}},async importPlaylists(){const l=this.$refs.fileSelector.files;for(let t of l)await this.importPlaylistFile(t);window.location.reload()},async importPlaylistFile(l){let t=(await l.text()).trim(),e=[];if(".csv"==l.name.slice(-4).toLowerCase()){const l=t.split("\n"),s=l[1].split(",");let i=0,a=null;s.length>2&&(a=s[4],i=4);const o={name:a??(new Date).toJSON(),videos:l.slice(i,l.length).filter((l=>""!=l)).slice(1).map((l=>`https://youtube.com/watch?v=${l.split(",")[0]}`))};e.push(this.createPlaylistWithVideos(o))}else{if(!t.includes('"Piped"'))return void alert(this.$t("actions.no_valid_playlists"));{let l=JSON.parse(t).playlists;if(!l.length)return void alert(this.$t("actions.no_valid_playlists"));for(let t of l)e.push(this.createPlaylistWithVideos(t))}}await Promise.all(e)},async createPlaylistWithVideos(l){let t=await this.createPlaylist(l.name),e=l.videos.map((l=>l.substr(-11)));await this.addVideosToPlaylist(t.playlistId,e)},async loadPlaylistBookmarks(){window.db&&(window.db.transaction("playlist_bookmarks","readonly").objectStore("playlist_bookmarks").openCursor().onsuccess=l=>{const t=l.target.result;t&&(this.bookmarks.push(t.value),t.continue())})},async removeBookmark(l){window.db.transaction("playlist_bookmarks","readwrite").objectStore("playlist_bookmarks").delete(this.bookmarks[l].playlistId),this.bookmarks.splice(l,1)}}},v={class:"my-4 font-bold"},C={class:"mb-3 flex justify-between"},x={class:"flex"},g={for:"fileSelector",class:"btn ml-2"},_={class:"video-grid"},M=["src"],$={class:"relative text-sm"},D=["textContent"],j=["title","textContent"],S=["onClick"],T=["onClick"],N={class:"flex flex-col gap-2"},E=["placeholder"],V=["placeholder"],J=["onClick"],B=r("hr",null,null,-1),I={class:"my-4 font-bold"},F={key:0,class:"video-grid"},O=["src"],U={class:"relative text-sm"},W=["textContent"],L=["onClick"],z=[r("i",{class:"i-fa6-solid:bookmark ml-3"},null,-1)],A=["title","textContent"],K=["href"],q=["src"],G=["textContent"],H=r("br",null,null,-1);l("default",a(t,[["render",function(l,t,e,s,i,a){const Q=u("router-link"),R=u("ModalComponent"),X=u("ConfirmModal"),Y=u("CreatePlaylistModal"),Z=w("t");return m(),o(c,null,[n(r("h2",v,null,512),[[Z,"titles.playlists"]]),r("div",C,[n(r("button",{class:"btn",onClick:t[0]||(t[0]=l=>i.showCreatePlaylistModal=!0)},null,512),[[Z,"actions.create_playlist"]]),r("div",x,[i.playlists.length>0?n((m(),o("button",{key:0,class:"btn",onClick:t[1]||(t[1]=(...l)=>a.exportPlaylists&&a.exportPlaylists(...l))},null,512)),[[Z,"actions.export_to_json"]]):d("",!0),r("input",{id:"fileSelector",ref:"fileSelector",type:"file",class:"hidden",multiple:"multiple",onChange:t[2]||(t[2]=(...l)=>a.importPlaylists&&a.importPlaylists(...l))},null,544),n(r("label",g,null,512),[[Z,"actions.import_from_json_csv"]])])]),r("div",_,[(m(!0),o(c,null,y(i.playlists,(e=>(m(),o("div",{key:e.id},[h(Q,{to:`/playlist?list=${e.id}`},{default:b((()=>[r("img",{class:"w-full",src:e.thumbnail,alt:"thumbnail"},null,8,M),r("div",$,[r("span",{class:"thumbnail-overlay thumbnail-right",textContent:f(`${e.videos} ${l.$t("video.videos")}`)},null,8,D)]),r("p",{style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"},class:"link my-2 flex overflow-hidden",title:e.name,textContent:f(e.name)},null,8,j)])),_:2},1032,["to"]),n(r("button",{class:"btn h-auto",onClick:l=>a.showPlaylistEditModal(e)},null,8,S),[[Z,"actions.edit_playlist"]]),n(r("button",{class:"btn ml-2 h-auto",onClick:l=>i.playlistToDelete=e.id},null,8,T),[[Z,"actions.delete_playlist"]]),e.id==i.playlistToEdit?(m(),p(R,{key:0,onClose:t[5]||(t[5]=l=>i.playlistToEdit=null)},{default:b((()=>[r("div",N,[n(r("h2",null,null,512),[[Z,"actions.edit_playlist"]]),n(r("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>i.newPlaylistName=l),class:"input",type:"text",placeholder:l.$t("actions.playlist_name")},null,8,E),[[k,i.newPlaylistName]]),n(r("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>i.newPlaylistDescription=l),class:"input",type:"text",placeholder:l.$t("actions.playlist_description")},null,8,V),[[k,i.newPlaylistDescription]]),n(r("button",{class:"btn ml-auto",onClick:l=>a.editPlaylist(e)},null,8,J),[[Z,"actions.okay"]])])])),_:2},1024)):d("",!0),i.playlistToDelete==e.id?(m(),p(X,{key:1,message:l.$t("actions.delete_playlist_confirm"),onClose:t[6]||(t[6]=l=>i.playlistToDelete=null),onConfirm:l=>a.onDeletePlaylist(e.id)},null,8,["message","onConfirm"])):d("",!0)])))),128))]),B,n(r("h2",I,null,512),[[Z,"titles.bookmarks"]]),i.bookmarks?(m(),o("div",F,[(m(!0),o(c,null,y(i.bookmarks,((t,e)=>(m(),p(Q,{key:t.playlistId,to:`/playlist?list=${t.playlistId}`},{default:b((()=>[r("img",{class:"w-full",src:t.thumbnail,alt:"thumbnail"},null,8,O),r("div",U,[r("span",{class:"thumbnail-overlay thumbnail-right",textContent:f(`${t.videos} ${l.$t("video.videos")}`)},null,8,W),r("div",{class:"absolute bottom-100px right-5px z-100 px-5px",onClick:P((l=>a.removeBookmark(e)),["prevent"])},z,8,L)]),r("p",{style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"},class:"link my-2 flex overflow-hidden",title:t.name,textContent:f(t.name)},null,8,A),r("a",{href:t.uploaderUrl,class:"flex items-center"},[r("img",{class:"h-32px w-32px rounded-full",src:t.uploaderAvatar},null,8,q),r("span",{class:"ml-3 hover:underline",textContent:f(t.uploader)},null,8,G)],8,K)])),_:2},1032,["to"])))),128))])):d("",!0),H,i.showCreatePlaylistModal?(m(),p(Y,{key:1,onClose:t[7]||(t[7]=l=>i.showCreatePlaylistModal=!1),onCreated:a.fetchPlaylists},null,8,["onCreated"])):d("",!0)],64)}]]))}}}));
//# sourceMappingURL=PlaylistsPage-legacy-Bad2ElLm.js.map
