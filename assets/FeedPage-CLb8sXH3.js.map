{"version":3,"file":"FeedPage-CLb8sXH3.js","sources":["../../src/components/FeedPage.vue"],"sourcesContent":["<template>\n    <h1 v-t=\"'titles.feed'\" class=\"my-4 text-center font-bold\" />\n\n    <div class=\"flex flex-col flex-wrap gap-2 children:(flex items-center gap-1) md:flex-row md:items-center\">\n        <span>\n            <label for=\"filters\">\n                <strong v-text=\"`${$t('actions.filter')}:`\" />\n            </label>\n            <select\n                id=\"filters\"\n                v-model=\"selectedFilter\"\n                default=\"all\"\n                class=\"select flex-grow\"\n                @change=\"onFilterChange()\"\n            >\n                <option v-for=\"filter in availableFilters\" :key=\"filter\" v-t=\"`video.${filter}`\" :value=\"filter\" />\n            </select>\n        </span>\n\n        <span>\n            <label for=\"group-selector\">\n                <strong v-text=\"`${$t('titles.channel_groups')}:`\" />\n            </label>\n            <select id=\"group-selector\" v-model=\"selectedGroupName\" default=\"\" class=\"select flex-grow\">\n                <option v-t=\"`video.all`\" value=\"\" />\n                <option\n                    v-for=\"group in channelGroups\"\n                    :key=\"group.groupName\"\n                    :value=\"group.groupName\"\n                    v-text=\"group.groupName\"\n                />\n            </select>\n        </span>\n\n        <span class=\"md:ml-auto\">\n            <SortingSelector by-key=\"uploaded\" @apply=\"order => videos.sort(order)\" />\n        </span>\n    </div>\n    <hr />\n\n    <span class=\"flex gap-2\">\n        <router-link v-t=\"'titles.subscriptions'\" class=\"btn\" to=\"/subscriptions\" />\n        <a :href=\"getRssUrl\" class=\"btn\">\n            <i class=\"i-fa6-solid:rss\" />\n        </a>\n    </span>\n    <hr />\n\n    <LoadingIndicatorPage :show-content=\"videosStore != null\" class=\"video-grid\">\n        <template v-for=\"video in filteredVideos\" :key=\"video.url\">\n            <VideoItem v-if=\"shouldShowVideo(video)\" :is-feed=\"true\" :item=\"video\" />\n        </template>\n    </LoadingIndicatorPage>\n</template>\n\n<script>\nimport VideoItem from \"./VideoItem.vue\";\nimport SortingSelector from \"./SortingSelector.vue\";\nimport LoadingIndicatorPage from \"./LoadingIndicatorPage.vue\";\n\nexport default {\n    components: {\n        VideoItem,\n        SortingSelector,\n        LoadingIndicatorPage,\n    },\n    data() {\n        return {\n            currentVideoCount: 0,\n            videoStep: 100,\n            videosStore: null,\n            videos: [],\n            availableFilters: [\"all\", \"shorts\", \"videos\"],\n            selectedFilter: \"all\",\n            selectedGroupName: \"\",\n            channelGroups: [],\n        };\n    },\n    computed: {\n        getRssUrl(_this) {\n            if (_this.authenticated) return _this.authApiUrl() + \"/feed/rss?authToken=\" + _this.getAuthToken();\n            else return _this.authApiUrl() + \"/feed/unauthenticated/rss?channels=\" + _this.getUnauthenticatedChannels();\n        },\n        filteredVideos(_this) {\n            const selectedGroup = _this.channelGroups.filter(group => group.groupName == _this.selectedGroupName);\n\n            const videos = this.getPreferenceBoolean(\"hideWatched\", false)\n                ? this.videos.filter(video => !video.watched)\n                : this.videos;\n\n            return _this.selectedGroupName == \"\"\n                ? videos\n                : videos.filter(video => selectedGroup[0].channels.includes(video.uploaderUrl.substr(-24)));\n        },\n    },\n    mounted() {\n        this.fetchFeed().then(resp => {\n            if (resp.error) {\n                alert(resp.error);\n                return;\n            }\n\n            this.videosStore = resp;\n            this.loadMoreVideos();\n            this.updateWatched(this.videos);\n        });\n\n        this.selectedFilter = this.getPreferenceString(\"feedFilter\") ?? \"all\";\n\n        if (!window.db) return;\n\n        this.loadChannelGroups();\n    },\n    activated() {\n        document.title = this.$t(\"titles.feed\") + \" - Piped\";\n        if (this.videos.length > 0) this.updateWatched(this.videos);\n        window.addEventListener(\"scroll\", this.handleScroll);\n    },\n    deactivated() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    unmounted() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    methods: {\n        async loadChannelGroups() {\n            const groups = await this.getChannelGroups();\n            this.channelGroups.push(...groups);\n        },\n        loadMoreVideos() {\n            if (!this.videosStore) return;\n            this.currentVideoCount = Math.min(this.currentVideoCount + this.videoStep, this.videosStore.length);\n            if (this.videos.length != this.videosStore.length) {\n                this.fetchDeArrowContent(this.videosStore.slice(this.videos.length, this.currentVideoCount));\n                this.videos = this.videosStore.slice(0, this.currentVideoCount);\n            }\n        },\n        handleScroll() {\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - window.innerHeight) {\n                this.loadMoreVideos();\n            }\n        },\n        shouldShowVideo(video) {\n            switch (this.selectedFilter.toLowerCase()) {\n                case \"shorts\":\n                    return video.isShort;\n                case \"videos\":\n                    return !video.isShort;\n                default:\n                    return true;\n            }\n        },\n        onFilterChange() {\n            this.setPreference(\"feedFilter\", this.selectedFilter);\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","VideoItem","SortingSelector","LoadingIndicatorPage","_this","selectedGroup","group","videos","video","resp","_a","groups","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_createElementVNode","_hoisted_12","_hoisted_13","_hoisted_14","_openBlock","_createElementBlock","_Fragment","_withDirectives","_toDisplayString","_ctx","_cache","$event","$data","$options","_renderList","filter","_createVNode","_component_SortingSelector","order","_hoisted_11","_component_router_link","_hoisted_15","_hoisted_16","_component_LoadingIndicatorPage","_withCtx","_createBlock","_component_VideoItem","_createCommentVNode"],"mappings":"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"}