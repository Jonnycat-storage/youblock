import{E as S,W as B,C as T}from"./WatchOnButton-Dm950qLy.js";import{L as q}from"./LoadingIndicatorPage-D98bvYGK.js";import{V as D}from"./VideoItem-BNJ24tbL.js";import{a as V,c as u,g as c,j as p,w as I,B as U,d as m,e as g,F as w,r as n,o,b as l,t as d,C as b,f as F}from"./index-DFHtCH6M.js";import"./ModalComponent-B-ePo8ic.js";import"./CreatePlaylistModal-D_amQld8.js";import"./ConfirmModal-DRMIgDMG.js";const E={components:{ErrorHandler:S,VideoItem:D,WatchOnButton:B,LoadingIndicatorPage:q,CollapsableText:T},data(){return{playlist:null,totalDuration:0,admin:!1,isBookmarked:!1}},computed:{getRssUrl:t=>t.authApiUrl()+"/rss/playlists/"+t.$route.query.list,isPipedPlaylist:t=>/[\da-fA-F]{8}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{12}/.test(t.$route.query.list)},mounted(){const t=this.$route.query.list;this.authenticated&&(t==null?void 0:t.length)==36?this.getPlaylists().then(e=>{e.error?alert(e.error):e.some(r=>r.id===t)&&(this.admin=!0)}):t.startsWith("local")&&(this.admin=!0),this.isPlaylistBookmarked()},activated(){this.getPlaylistData(),window.addEventListener("scroll",this.handleScroll),this.playlist&&this.updateTitle()},deactivated(){window.removeEventListener("scroll",this.handleScroll)},methods:{async getPlaylistData(){this.getPlaylist(this.$route.query.list).then(t=>this.playlist=t).then(()=>{this.updateTitle(),this.updateTotalDuration(),this.updateWatched(this.playlist.relatedStreams),this.fetchDeArrowContent(this.playlist.relatedStreams)})},async updateTitle(){document.title=this.playlist.name+" - Piped"},handleScroll(){this.loading||!this.playlist||!this.playlist.nextpage||window.innerHeight+window.scrollY>=document.body.offsetHeight-window.innerHeight&&(this.loading=!0,this.fetchJson(this.authApiUrl()+"/nextpage/playlists/"+this.$route.query.list,{nextpage:this.playlist.nextpage}).then(t=>{this.playlist.nextpage=t.nextpage,this.loading=!1,this.playlist.relatedStreams.push(...t.relatedStreams),this.updateTotalDuration(),this.fetchDeArrowContent(t.relatedStreams)}))},removeVideo(t){this.playlist.relatedStreams.splice(t,1)},updateTotalDuration(){this.totalDuration=this.playlist.relatedStreams.map(t=>t.duration).reduce((t,e)=>t+e)},async clonePlaylist(){this.fetchJson(this.authApiUrl()+"/import/playlist",null,{method:"POST",headers:{Authorization:this.getAuthToken()},body:JSON.stringify({playlistId:this.$route.query.list})}).then(t=>{t.error?alert(t.error):alert(this.$t("actions.clone_playlist_success"))})},downloadPlaylistAsTxt(){const t=this.playlist.relatedStreams.map(e=>"https://piped.video"+e.url).join("\n");this.download(t,this.playlist.name+".txt","text/plain")},async bookmarkPlaylist(){if(this.playlist){if(this.isBookmarked){this.removePlaylistBookmark();return}if(window.db){const r=this.$route.query.list;var t=window.db.transaction("playlist_bookmarks","readwrite"),e=t.objectStore("playlist_bookmarks");e.put({playlistId:r,name:this.playlist.name,uploader:this.playlist.uploader,uploaderUrl:this.playlist.uploaderUrl,thumbnail:this.playlist.thumbnailUrl,uploaderAvatar:this.playlist.uploaderAvatar,videos:this.playlist.videos}),this.isBookmarked=!0}}},async removePlaylistBookmark(){var t=window.db.transaction("playlist_bookmarks","readwrite"),e=t.objectStore("playlist_bookmarks");e.delete(this.$route.query.list),this.isBookmarked=!1},async isPlaylistBookmarked(){const t=this,e=this.$route.query.list;var r=window.db.transaction("playlist_bookmarks","readwrite"),y=r.objectStore("playlist_bookmarks"),s=y.openCursor(e);s.onsuccess=function(i){var h=i.target.result;t.isBookmarked=!!h}}}},L=["textContent"],H={class:"mt-1 flex justify-between <md:flex-col md:items-center"},W=["src"],N=["textContent"],O={class:"flex flex-wrap items-center gap-1"},R=["textContent"],J=l("i",{class:"i-fa6-solid:bookmark ml-3"},null,-1),j=l("i",{class:"i-fa6-solid:clone ml-3"},null,-1),z=["href"],Y=l("i",{class:"i-fa6-solid:rss"},null,-1),G=[Y],K=l("hr",null,null,-1),M={class:"video-grid"};function Q(t,e,r,y,s,i){var k;const h=n("ErrorHandler"),v=n("CollapsableText"),x=n("router-link"),P=n("WatchOnButton"),C=n("VideoItem"),A=n("LoadingIndicatorPage");return o(),u(w,null,[s.playlist&&s.playlist.error?(o(),c(h,{key:0,message:s.playlist.message,error:s.playlist.error},null,8,["message","error"])):p("",!0),I(m(A,{"show-content":s.playlist},{default:g(()=>{var f;return[l("h1",{class:"mb-1 ml-1 mt-4 text-3xl!",textContent:d(s.playlist.name)},null,8,L),(f=s.playlist)!=null&&f.description?(o(),c(v,{key:0,text:s.playlist.description},null,8,["text"])):p("",!0),l("div",H,[l("div",null,[m(x,{class:"link flex items-center gap-3",to:s.playlist.uploaderUrl||"/"},{default:g(()=>[l("img",{loading:"lazy",src:s.playlist.uploaderAvatar,class:"h-12 rounded-full"},null,8,W),l("strong",{textContent:d(s.playlist.uploader)},null,8,N)]),_:1},8,["to"])]),l("div",O,[l("strong",{textContent:d("".concat(s.playlist.videos," ").concat(t.$t("video.videos")," - ").concat(t.timeFormat(s.totalDuration)).concat(s.playlist.nextpage?"+":""))},null,8,R),i.isPipedPlaylist?p("",!0):(o(),u("button",{key:0,class:"btn mx-1",onClick:e[0]||(e[0]=(...a)=>i.bookmarkPlaylist&&i.bookmarkPlaylist(...a))},[b(d(t.$t("actions.".concat(s.isBookmarked?"playlist_bookmarked":"bookmark_playlist"))),1),J])),t.authenticated&&!i.isPipedPlaylist?(o(),u("button",{key:1,class:"btn mr-1",onClick:e[1]||(e[1]=(...a)=>i.clonePlaylist&&i.clonePlaylist(...a))},[b(d(t.$t("actions.clone_playlist")),1),j])):p("",!0),l("button",{class:"btn mr-1",onClick:e[2]||(e[2]=(...a)=>i.downloadPlaylistAsTxt&&i.downloadPlaylistAsTxt(...a))},d(t.$t("actions.download_as_txt")),1),l("a",{class:"btn mr-1",href:i.getRssUrl},G,8,z),m(P,{link:"https://www.youtube.com/playlist?list=".concat(t.$route.query.list)},null,8,["link"])])]),K,l("div",M,[(o(!0),u(w,null,F(s.playlist.relatedStreams,(a,_)=>(o(),c(C,{key:a.url,item:a,index:_,"playlist-id":t.$route.query.list,admin:s.admin,height:"94",width:"168",onRemove:X=>i.removeVideo(_)},null,8,["item","index","playlist-id","admin","onRemove"]))),128))])]}),_:1},8,["show-content"]),[[U,!((k=s.playlist)!=null&&k.error)]])],64)}const at=V(E,[["render",Q]]);export{at as default};
//# sourceMappingURL=PlaylistPage-DcL8Llqv.js.map
