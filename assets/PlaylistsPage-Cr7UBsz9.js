import{C as g}from"./ConfirmModal-DRMIgDMG.js";import{M as D}from"./ModalComponent-B-ePo8ic.js";import{C as M}from"./CreatePlaylistModal-D_amQld8.js";import{a as S,c as p,w as d,b as l,j as y,F as b,f as P,g as f,r as k,o as c,d as T,e as w,t as _,l as C,y as N,h as V}from"./index-DFHtCH6M.js";const B={components:{ConfirmModal:g,ModalComponent:D,CreatePlaylistModal:M},data(){return{playlists:[],bookmarks:[],playlistToDelete:null,playlistToEdit:null,newPlaylistName:"",newPlaylistDescription:"",showCreatePlaylistModal:!1}},mounted(){this.fetchPlaylists(),this.loadPlaylistBookmarks()},activated(){document.title=this.$t("titles.playlists")+" - Piped"},methods:{fetchPlaylists(){this.getPlaylists().then(e=>{this.playlists=e})},showPlaylistEditModal(e){this.newPlaylistName=e.name,this.newPlaylistDescription=e.description,this.playlistToEdit=e.id},editPlaylist(e){const t=this.newPlaylistName,o=this.newPlaylistDescription;t!=e.name&&this.renamePlaylist(e.id,t).then(n=>{n.error?alert(n.error):e.name=t}),o!=e.description&&this.changePlaylistDescription(e.id,o).then(n=>{n.error?alert(n.error):e.description=o}),this.playlistToEdit=null},onDeletePlaylist(e){this.deletePlaylist(e).then(t=>{t.error?alert(t.error):this.playlists=this.playlists.filter(o=>o.id!==e)}),this.playlistToDelete=null},async exportPlaylists(){if(!this.playlists)return;let e={format:"Piped",version:1,playlists:[]},t=this.playlists.map(o=>this.fetchPlaylistJson(o.id));e.playlists=await Promise.all(t),this.download(JSON.stringify(e),"playlists.json","application/json")},async fetchPlaylistJson(e){let t=await this.getPlaylist(e);return{name:t.name,type:"playlist",visibility:"private",videos:t.relatedStreams.map(o=>"https://youtube.com"+o.url)}},async importPlaylists(){const e=this.$refs.fileSelector.files;for(let t of e)await this.importPlaylistFile(t);window.location.reload()},async importPlaylistFile(e){let t=(await e.text()).trim(),o=[];if(e.name.slice(-4).toLowerCase()==".csv"){const n=t.split("\n"),i=n[1].split(",");let a=0,u=null;i.length>2&&(u=i[4],a=4);const v={name:u!=null?u:new Date().toJSON(),videos:n.slice(a,n.length).filter(h=>h!="").slice(1).map(h=>"https://youtube.com/watch?v=".concat(h.split(",")[0]))};o.push(this.createPlaylistWithVideos(v))}else if(t.includes('"Piped"')){let n=JSON.parse(t).playlists;if(!n.length){alert(this.$t("actions.no_valid_playlists"));return}for(let i of n)o.push(this.createPlaylistWithVideos(i))}else{alert(this.$t("actions.no_valid_playlists"));return}await Promise.all(o)},async createPlaylistWithVideos(e){let t=await this.createPlaylist(e.name),o=e.videos.map(n=>n.substr(-11));await this.addVideosToPlaylist(t.playlistId,o)},async loadPlaylistBookmarks(){if(!window.db)return;var e=window.db.transaction("playlist_bookmarks","readonly"),t=e.objectStore("playlist_bookmarks");const o=t.openCursor();o.onsuccess=n=>{const i=n.target.result;i&&(this.bookmarks.push(i.value),i.continue())}},async removeBookmark(e){var t=window.db.transaction("playlist_bookmarks","readwrite"),o=t.objectStore("playlist_bookmarks");o.delete(this.bookmarks[e].playlistId),this.bookmarks.splice(e,1)}}},E={class:"my-4 font-bold"},I={class:"mb-3 flex justify-between"},j={class:"flex"},J={for:"fileSelector",class:"btn ml-2"},F={class:"video-grid"},$=["src"],L={class:"relative text-sm"},O=["textContent"],U=["title","textContent"],W=["onClick"],q=["onClick"],z={class:"flex flex-col gap-2"},A=["placeholder"],R=["placeholder"],G=["onClick"],H=l("hr",null,null,-1),K={class:"my-4 font-bold"},Q={key:0,class:"video-grid"},X=["src"],Y={class:"relative text-sm"},Z=["textContent"],tt=["onClick"],et=l("i",{class:"i-fa6-solid:bookmark ml-3"},null,-1),lt=[et],st=["title","textContent"],it=["href"],ot=["src"],nt=["textContent"],at=l("br",null,null,-1);function rt(e,t,o,n,i,a){const u=k("router-link"),v=k("ModalComponent"),h=k("ConfirmModal"),x=k("CreatePlaylistModal"),m=V("t");return c(),p(b,null,[d(l("h2",E,null,512),[[m,"titles.playlists"]]),l("div",I,[d(l("button",{class:"btn",onClick:t[0]||(t[0]=s=>i.showCreatePlaylistModal=!0)},null,512),[[m,"actions.create_playlist"]]),l("div",j,[i.playlists.length>0?d((c(),p("button",{key:0,class:"btn",onClick:t[1]||(t[1]=(...s)=>a.exportPlaylists&&a.exportPlaylists(...s))},null,512)),[[m,"actions.export_to_json"]]):y("",!0),l("input",{id:"fileSelector",ref:"fileSelector",type:"file",class:"hidden",multiple:"multiple",onChange:t[2]||(t[2]=(...s)=>a.importPlaylists&&a.importPlaylists(...s))},null,544),d(l("label",J,null,512),[[m,"actions.import_from_json_csv"]])])]),l("div",F,[(c(!0),p(b,null,P(i.playlists,s=>(c(),p("div",{key:s.id},[T(u,{to:"/playlist?list=".concat(s.id)},{default:w(()=>[l("img",{class:"w-full",src:s.thumbnail,alt:"thumbnail"},null,8,$),l("div",L,[l("span",{class:"thumbnail-overlay thumbnail-right",textContent:_("".concat(s.videos," ").concat(e.$t("video.videos")))},null,8,O)]),l("p",{style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"},class:"link my-2 flex overflow-hidden",title:s.name,textContent:_(s.name)},null,8,U)]),_:2},1032,["to"]),d(l("button",{class:"btn h-auto",onClick:r=>a.showPlaylistEditModal(s)},null,8,W),[[m,"actions.edit_playlist"]]),d(l("button",{class:"btn ml-2 h-auto",onClick:r=>i.playlistToDelete=s.id},null,8,q),[[m,"actions.delete_playlist"]]),s.id==i.playlistToEdit?(c(),f(v,{key:0,onClose:t[5]||(t[5]=r=>i.playlistToEdit=null)},{default:w(()=>[l("div",z,[d(l("h2",null,null,512),[[m,"actions.edit_playlist"]]),d(l("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>i.newPlaylistName=r),class:"input",type:"text",placeholder:e.$t("actions.playlist_name")},null,8,A),[[C,i.newPlaylistName]]),d(l("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>i.newPlaylistDescription=r),class:"input",type:"text",placeholder:e.$t("actions.playlist_description")},null,8,R),[[C,i.newPlaylistDescription]]),d(l("button",{class:"btn ml-auto",onClick:r=>a.editPlaylist(s)},null,8,G),[[m,"actions.okay"]])])]),_:2},1024)):y("",!0),i.playlistToDelete==s.id?(c(),f(h,{key:1,message:e.$t("actions.delete_playlist_confirm"),onClose:t[6]||(t[6]=r=>i.playlistToDelete=null),onConfirm:r=>a.onDeletePlaylist(s.id)},null,8,["message","onConfirm"])):y("",!0)]))),128))]),H,d(l("h2",K,null,512),[[m,"titles.bookmarks"]]),i.bookmarks?(c(),p("div",Q,[(c(!0),p(b,null,P(i.bookmarks,(s,r)=>(c(),f(u,{key:s.playlistId,to:"/playlist?list=".concat(s.playlistId)},{default:w(()=>[l("img",{class:"w-full",src:s.thumbnail,alt:"thumbnail"},null,8,X),l("div",Y,[l("span",{class:"thumbnail-overlay thumbnail-right",textContent:_("".concat(s.videos," ").concat(e.$t("video.videos")))},null,8,Z),l("div",{class:"absolute bottom-100px right-5px z-100 px-5px",onClick:N(dt=>a.removeBookmark(r),["prevent"])},lt,8,tt)]),l("p",{style:{display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"},class:"link my-2 flex overflow-hidden",title:s.name,textContent:_(s.name)},null,8,st),l("a",{href:s.uploaderUrl,class:"flex items-center"},[l("img",{class:"h-32px w-32px rounded-full",src:s.uploaderAvatar},null,8,ot),l("span",{class:"ml-3 hover:underline",textContent:_(s.uploader)},null,8,nt)],8,it)]),_:2},1032,["to"]))),128))])):y("",!0),at,i.showCreatePlaylistModal?(c(),f(x,{key:1,onClose:t[7]||(t[7]=s=>i.showCreatePlaylistModal=!1),onCreated:a.fetchPlaylists},null,8,["onCreated"])):y("",!0)],64)}const ht=S(B,[["render",rt]]);export{ht as default};
//# sourceMappingURL=PlaylistsPage-Cr7UBsz9.js.map
