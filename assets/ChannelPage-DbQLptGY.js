import{E as M,W as N,C as P}from"./WatchOnButton-Dm950qLy.js";import{_ as U}from"./ContentItem-BvthkZQ-.js";import{L as D}from"./LoadingIndicatorPage-D98bvYGK.js";import{M as H}from"./ModalComponent-B-ePo8ic.js";import{C as L}from"./CreateGroupModal-2oLKRFul.js";import{a as T,o as a,c as o,d as b,e as S,b as s,w as v,F as p,f as x,t as f,g as _,j as c,r as h,h as G,n as E}from"./index-DFHtCH6M.js";const A={components:{ModalComponent:H,CreateGroupModal:L},props:{channelId:{type:String,required:!0}},emits:["close"],data(){return{showCreateGroupModal:!1,channelGroups:[]}},mounted(){this.loadChannelGroups()},methods:{async loadChannelGroups(){const e=await this.getChannelGroups();this.channelGroups.push(...e)},onCheckedChange(e,t){t.channels.includes(this.channelId)?t.channels.splice(e,1):t.channels.push(this.channelId),this.createOrUpdateChannelGroup(t)},onCreateGroup(e){if(!e||this.channelGroups.some(l=>l.groupName==e))return;const t={groupName:e,channels:[]};this.channelGroups.push(t),this.createOrUpdateChannelGroup(t),this.showCreateGroupModal=!1}}},B={class:"min-w-[50vw] flex flex-col"},W={class:"h-[70vh] overflow-y-scroll pr-4"},O={class:"mb-3 inline-block w-max text-2xl"},$={class:"flex items-center justify-between"},J=["checked","onChange"],F=s("hr",{class:"h-1 w-full"},null,-1);function R(e,t,l,u,n,d){const C=h("ModalComponent"),g=h("CreateGroupModal"),m=G("t");return a(),o(p,null,[b(C,{onClose:t[1]||(t[1]=r=>e.$emit("close"))},{default:S(()=>[s("div",B,[s("div",W,[v(s("span",O,null,512),[[m,"actions.add_to_group"]]),(a(!0),o(p,null,x(n.channelGroups,(r,w)=>(a(),o("div",{key:r.groupName,class:"px-1"},[s("div",$,[s("span",null,f(r.groupName),1),s("input",{type:"checkbox",checked:r.channels.includes(l.channelId),onChange:k=>d.onCheckedChange(w,r)},null,40,J)]),F]))),128))]),v(s("button",{class:"btn ml-auto w-max",onClick:t[0]||(t[0]=r=>n.showCreateGroupModal=!0)},null,512),[[m,"actions.create_group"]])])]),_:1}),n.showCreateGroupModal?(a(),_(g,{key:0,"on-create-group":d.onCreateGroup,onClose:t[2]||(t[2]=r=>n.showCreateGroupModal=!1)},null,8,["on-create-group"])):c("",!0)],64)}const V=T(A,[["render",R]]),q={components:{ErrorHandler:M,ContentItem:U,WatchOnButton:N,LoadingIndicatorPage:D,CollapsableText:P,AddToGroupModal:V},data(){return{channel:null,subscribed:!1,tabs:[],selectedTab:0,contentItems:[],showGroupModal:!1}},mounted(){this.getChannelData()},activated(){this.channel&&!this.channel.error&&(document.title=this.channel.name+" - Piped"),window.addEventListener("scroll",this.handleScroll),this.channel&&!this.channel.error&&this.updateWatched(this.channel.relatedStreams)},deactivated(){window.removeEventListener("scroll",this.handleScroll)},unmounted(){window.removeEventListener("scroll",this.handleScroll)},methods:{async fetchSubscribedStatus(){this.channel.id&&(this.subscribed=await this.fetchSubscriptionStatus(this.channel.id))},async fetchChannel(){const e=this.$route.path.includes("@")?this.apiUrl()+"/@/"+this.$route.params.channelId:this.apiUrl()+"/"+this.$route.params.path+"/"+this.$route.params.channelId;return await this.fetchJson(e)},async getChannelData(){this.fetchChannel().then(e=>this.channel=e).then(()=>{if(!this.channel.error){document.title=this.channel.name+" - Piped",this.contentItems=this.channel.relatedStreams,this.fetchSubscribedStatus(),this.updateWatched(this.channel.relatedStreams),this.fetchDeArrowContent(this.channel.relatedStreams),this.tabs.push({translatedName:this.$t("video.videos")});const e=this.$route.query.tab;for(let t=0;t<this.channel.tabs.length;t++){let l=this.channel.tabs[t];l.translatedName=this.getTranslatedTabName(l.name),this.tabs.push(l),l.name===e&&this.loadTab(t+1)}}})},handleScroll(){this.loading||!this.channel||!this.channel.nextpage||this.selectedTab!=0&&!this.tabs[this.selectedTab].tabNextPage||window.innerHeight+window.scrollY>=document.body.offsetHeight-window.innerHeight&&(this.loading=!0,this.selectedTab==0?this.fetchChannelNextPage():this.fetchChannelTabNextPage())},fetchChannelNextPage(){this.fetchJson(this.apiUrl()+"/nextpage/channel/"+this.channel.id,{nextpage:this.channel.nextpage}).then(e=>{this.channel.nextpage=e.nextpage,this.loading=!1,this.updateWatched(e.relatedStreams),this.contentItems.push(...e.relatedStreams),this.fetchDeArrowContent(e.relatedStreams)})},fetchChannelTabNextPage(){this.fetchJson(this.apiUrl()+"/channels/tabs",{data:this.tabs[this.selectedTab].data,nextpage:this.tabs[this.selectedTab].tabNextPage}).then(e=>{this.tabs[this.selectedTab].tabNextPage=e.nextpage,this.loading=!1,e.this.contentItems.push(...e.content),this.fetchDeArrowContent(e.content),this.tabs[this.selectedTab].content=this.contentItems})},subscribeHandler(){this.toggleSubscriptionState(this.channel.id,this.subscribed).then(e=>{e&&(this.subscribed=!this.subscribed)})},getTranslatedTabName(e){let t=e;switch(e){case"livestreams":t=this.$t("titles.livestreams");break;case"playlists":t=this.$t("titles.playlists");break;case"albums":t=this.$t("titles.albums");break;case"shorts":t=this.$t("video.shorts");break;default:console.error('Tab name "'.concat(e,'" is not translated yet!'));break}return t},loadTab(e){var l;this.selectedTab=e;const t=new URL(window.location);if(t.searchParams.set("tab",(l=this.tabs[e].name)!=null?l:"videos"),window.history.replaceState(window.history.state,"",t),e==0){this.contentItems=this.channel.relatedStreams;return}if(this.tabs[e].content){this.contentItems=this.tabs[e].content;return}this.fetchJson(this.apiUrl()+"/channels/tabs",{data:this.tabs[e].data}).then(u=>{this.contentItems=this.tabs[e].content=u.content,this.fetchDeArrowContent(u.content),this.tabs[this.selectedTab].tabNextPage=u.nextpage})}}},z=["src"],Q={class:"flex flex-col items-center justify-between md:flex-row"},Y={class:"flex place-items-center"},K=["src"],X={class:"flex items-center gap-1"},Z=["textContent"],j={key:0,class:"i-fa6-solid:check !text-xl"},ee={class:"flex gap-2"},te=["textContent"],ne=["href"],se=s("i",{class:"i-fa6-solid:rss"},null,-1),ae=[se],le={class:"mx-1 my-2 flex"},oe=["onClick"],re=["textContent"],ie=s("hr",null,null,-1),he={class:"video-grid"};function ce(e,t,l,u,n,d){const C=h("ErrorHandler"),g=h("CollapsableText"),m=h("WatchOnButton"),r=h("ContentItem"),w=h("AddToGroupModal"),k=h("LoadingIndicatorPage"),I=G("t");return a(),o(p,null,[n.channel&&n.channel.error?(a(),_(C,{key:0,message:n.channel.message,error:n.channel.error},null,8,["message","error"])):c("",!0),b(k,{"show-content":n.channel!=null&&!n.channel.error},{default:S(()=>[n.channel.bannerUrl?(a(),o("img",{key:0,loading:"lazy",src:n.channel.bannerUrl,class:"h-30 w-full object-cover py-1.5 md:h-50"},null,8,z)):c("",!0),s("div",Q,[s("div",Y,[s("img",{height:"48",width:"48",class:"m-1 rounded-full",src:n.channel.avatarUrl},null,8,K),s("div",X,[s("h1",{class:"!text-xl",textContent:f(n.channel.name)},null,8,Z),n.channel.verified?(a(),o("i",j)):c("",!0)])]),s("div",ee,[s("button",{class:"btn",onClick:t[0]||(t[0]=(...i)=>d.subscribeHandler&&d.subscribeHandler(...i)),textContent:f(e.$t("actions."+(n.subscribed?"unsubscribe":"subscribe"))+" - "+e.numberFormat(n.channel.subscriberCount))},null,8,te),n.subscribed?v((a(),o("button",{key:0,class:"btn",onClick:t[1]||(t[1]=i=>n.showGroupModal=!0)},null,512)),[[I,"actions.add_to_group"]]):c("",!0),n.channel.id?(a(),o("a",{key:1,"aria-label":"RSS feed",title:"RSS feed",role:"button",href:"".concat(e.apiUrl(),"/feed/unauthenticated/rss?channels=").concat(n.channel.id),target:"_blank",class:"btn flex-col"},ae,8,ne)):c("",!0)])]),b(g,{text:n.channel.description},null,8,["text"]),b(m,{link:"https://youtube.com/channel/".concat(n.channel.id)},null,8,["link"]),s("div",le,[(a(!0),o(p,null,x(n.tabs,(i,y)=>(a(),o("button",{key:i.name,class:E(["btn mr-2",{active:n.selectedTab==y}]),onClick:de=>d.loadTab(y)},[s("span",{textContent:f(i.translatedName)},null,8,re)],10,oe))),128))]),ie,s("div",he,[(a(!0),o(p,null,x(n.contentItems,i=>(a(),_(r,{key:i.url,item:i,height:"94",width:"168","hide-channel":""},null,8,["item"]))),128))]),n.showGroupModal?(a(),_(w,{key:1,"channel-id":n.channel.id.substr(-24),onClose:t[2]||(t[2]=i=>n.showGroupModal=!1)},null,8,["channel-id"])):c("",!0)]),_:1},8,["show-content"])],64)}const Ce=T(q,[["render",ce]]);export{Ce as default};
//# sourceMappingURL=ChannelPage-DbQLptGY.js.map
