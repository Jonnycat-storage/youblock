{"version":3,"file":"PlaylistPage-legacy-Bj8opVke.js","sources":["../../src/components/PlaylistPage.vue"],"sourcesContent":["<template>\n    <ErrorHandler v-if=\"playlist && playlist.error\" :message=\"playlist.message\" :error=\"playlist.error\" />\n\n    <LoadingIndicatorPage v-show=\"!playlist?.error\" :show-content=\"playlist\">\n        <h1 class=\"mb-1 ml-1 mt-4 text-3xl!\" v-text=\"playlist.name\" />\n\n        <CollapsableText v-if=\"playlist?.description\" :text=\"playlist.description\" />\n\n        <div class=\"mt-1 flex justify-between <md:flex-col md:items-center\">\n            <div>\n                <router-link class=\"link flex items-center gap-3\" :to=\"playlist.uploaderUrl || '/'\">\n                    <img loading=\"lazy\" :src=\"playlist.uploaderAvatar\" class=\"h-12 rounded-full\" />\n                    <strong v-text=\"playlist.uploader\" />\n                </router-link>\n            </div>\n            <div class=\"flex flex-wrap items-center gap-1\">\n                <strong\n                    v-text=\"\n                        `${playlist.videos} ${$t('video.videos')} - ${timeFormat(totalDuration)}${playlist.nextpage ? '+' : ''}`\n                    \"\n                />\n                <button v-if=\"!isPipedPlaylist\" class=\"btn mx-1\" @click=\"bookmarkPlaylist\">\n                    {{ $t(`actions.${isBookmarked ? \"playlist_bookmarked\" : \"bookmark_playlist\"}`)\n                    }}<i class=\"i-fa6-solid:bookmark ml-3\" />\n                </button>\n                <button v-if=\"authenticated && !isPipedPlaylist\" class=\"btn mr-1\" @click=\"clonePlaylist\">\n                    {{ $t(\"actions.clone_playlist\") }}<i class=\"i-fa6-solid:clone ml-3\" />\n                </button>\n                <button class=\"btn mr-1\" @click=\"downloadPlaylistAsTxt\">\n                    {{ $t(\"actions.download_as_txt\") }}\n                </button>\n                <a class=\"btn mr-1\" :href=\"getRssUrl\">\n                    <i class=\"i-fa6-solid:rss\" />\n                </a>\n                <WatchOnButton :link=\"`https://www.youtube.com/playlist?list=${$route.query.list}`\" />\n            </div>\n        </div>\n\n        <hr />\n\n        <div class=\"video-grid\">\n            <VideoItem\n                v-for=\"(video, index) in playlist.relatedStreams\"\n                :key=\"video.url\"\n                :item=\"video\"\n                :index=\"index\"\n                :playlist-id=\"$route.query.list\"\n                :admin=\"admin\"\n                height=\"94\"\n                width=\"168\"\n                @remove=\"removeVideo(index)\"\n            />\n        </div>\n    </LoadingIndicatorPage>\n</template>\n\n<script>\nimport ErrorHandler from \"./ErrorHandler.vue\";\nimport LoadingIndicatorPage from \"./LoadingIndicatorPage.vue\";\nimport CollapsableText from \"./CollapsableText.vue\";\nimport VideoItem from \"./VideoItem.vue\";\nimport WatchOnButton from \"./WatchOnButton.vue\";\n\nexport default {\n    components: {\n        ErrorHandler,\n        VideoItem,\n        WatchOnButton,\n        LoadingIndicatorPage,\n        CollapsableText,\n    },\n    data() {\n        return {\n            playlist: null,\n            totalDuration: 0,\n            admin: false,\n            isBookmarked: false,\n        };\n    },\n    computed: {\n        getRssUrl: _this => {\n            return _this.authApiUrl() + \"/rss/playlists/\" + _this.$route.query.list;\n        },\n        isPipedPlaylist: _this => {\n            // regex to determine whether it's a Piped plalylist\n            return /[\\da-fA-F]{8}-[\\da-fA-F]{4}-[\\da-fA-F]{4}-[\\da-fA-F]{4}-[\\da-fA-F]{12}/.test(\n                _this.$route.query.list,\n            );\n        },\n    },\n    mounted() {\n        const playlistId = this.$route.query.list;\n        if (this.authenticated && playlistId?.length == 36)\n            this.getPlaylists().then(json => {\n                if (json.error) alert(json.error);\n                else if (json.some(playlist => playlist.id === playlistId)) this.admin = true;\n            });\n        else if (playlistId.startsWith(\"local\")) this.admin = true;\n        this.isPlaylistBookmarked();\n    },\n    activated() {\n        this.getPlaylistData();\n        window.addEventListener(\"scroll\", this.handleScroll);\n        if (this.playlist) this.updateTitle();\n    },\n    deactivated() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    methods: {\n        async getPlaylistData() {\n            this.getPlaylist(this.$route.query.list)\n                .then(data => (this.playlist = data))\n                .then(() => {\n                    this.updateTitle();\n                    this.updateTotalDuration();\n                    this.updateWatched(this.playlist.relatedStreams);\n                    this.fetchDeArrowContent(this.playlist.relatedStreams);\n                });\n        },\n        async updateTitle() {\n            document.title = this.playlist.name + \" - Piped\";\n        },\n        handleScroll() {\n            if (this.loading || !this.playlist || !this.playlist.nextpage) return;\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - window.innerHeight) {\n                this.loading = true;\n                this.fetchJson(this.authApiUrl() + \"/nextpage/playlists/\" + this.$route.query.list, {\n                    nextpage: this.playlist.nextpage,\n                }).then(json => {\n                    this.playlist.nextpage = json.nextpage;\n                    this.loading = false;\n                    this.playlist.relatedStreams.push(...json.relatedStreams);\n                    this.updateTotalDuration();\n                    this.fetchDeArrowContent(json.relatedStreams);\n                });\n            }\n        },\n        removeVideo(index) {\n            this.playlist.relatedStreams.splice(index, 1);\n        },\n        updateTotalDuration() {\n            this.totalDuration = this.playlist.relatedStreams.map(video => video.duration).reduce((a, b) => a + b);\n        },\n        async clonePlaylist() {\n            this.fetchJson(this.authApiUrl() + \"/import/playlist\", null, {\n                method: \"POST\",\n                headers: {\n                    Authorization: this.getAuthToken(),\n                },\n                body: JSON.stringify({\n                    playlistId: this.$route.query.list,\n                }),\n            }).then(resp => {\n                if (!resp.error) {\n                    alert(this.$t(\"actions.clone_playlist_success\"));\n                } else alert(resp.error);\n            });\n        },\n        downloadPlaylistAsTxt() {\n            const data = this.playlist.relatedStreams\n                .map(video => {\n                    return \"https://piped.video\" + video.url;\n                })\n                .join(\"\\n\");\n            this.download(data, this.playlist.name + \".txt\", \"text/plain\");\n        },\n        async bookmarkPlaylist() {\n            if (!this.playlist) return;\n\n            if (this.isBookmarked) {\n                this.removePlaylistBookmark();\n                return;\n            }\n\n            if (window.db) {\n                const playlistId = this.$route.query.list;\n                var tx = window.db.transaction(\"playlist_bookmarks\", \"readwrite\");\n                var store = tx.objectStore(\"playlist_bookmarks\");\n                store.put({\n                    playlistId: playlistId,\n                    name: this.playlist.name,\n                    uploader: this.playlist.uploader,\n                    uploaderUrl: this.playlist.uploaderUrl,\n                    thumbnail: this.playlist.thumbnailUrl,\n                    uploaderAvatar: this.playlist.uploaderAvatar,\n                    videos: this.playlist.videos,\n                });\n                this.isBookmarked = true;\n            }\n        },\n        async removePlaylistBookmark() {\n            var tx = window.db.transaction(\"playlist_bookmarks\", \"readwrite\");\n            var store = tx.objectStore(\"playlist_bookmarks\");\n            store.delete(this.$route.query.list);\n            this.isBookmarked = false;\n        },\n        async isPlaylistBookmarked() {\n            // needed in order to change the is bookmarked var later\n            const App = this;\n            const playlistId = this.$route.query.list;\n            var tx = window.db.transaction(\"playlist_bookmarks\", \"readwrite\");\n            var store = tx.objectStore(\"playlist_bookmarks\");\n            var req = store.openCursor(playlistId);\n            req.onsuccess = function (e) {\n                var cursor = e.target.result;\n                App.isBookmarked = cursor ? true : false;\n            };\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","components","ErrorHandler","VideoItem","WatchOnButton","LoadingIndicatorPage","CollapsableText","data","playlist","totalDuration","admin","isBookmarked","computed","getRssUrl","_this","authApiUrl","$route","query","list","isPipedPlaylist","test","mounted","playlistId","this","authenticated","length","getPlaylists","then","json","error","alert","some","id","startsWith","isPlaylistBookmarked","activated","getPlaylistData","window","addEventListener","handleScroll","updateTitle","deactivated","removeEventListener","methods","getPlaylist","updateTotalDuration","updateWatched","relatedStreams","fetchDeArrowContent","document","title","name","loading","nextpage","innerHeight","scrollY","body","offsetHeight","fetchJson","push","removeVideo","index","splice","map","video","duration","reduce","a","b","clonePlaylist","method","headers","Authorization","getAuthToken","JSON","stringify","resp","$t","downloadPlaylistAsTxt","url","join","download","bookmarkPlaylist","removePlaylistBookmark","db","transaction","objectStore","put","uploader","uploaderUrl","thumbnail","thumbnailUrl","uploaderAvatar","videos","delete","App","openCursor","onsuccess","e","cursor","target","result","_hoisted_1","_hoisted_2","class","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_createElementVNode","_hoisted_9","_hoisted_13","_openBlock","_createElementBlock","_Fragment","$data","_createBlock","_component_ErrorHandler","key","message","_createCommentVNode","_createVNode","_component_LoadingIndicatorPage","default","_withCtx","textContent","_toDisplayString","description","_component_CollapsableText","text","_component_router_link","to","src","_","_ctx","timeFormat","$options","onClick","args","_createTextVNode","_hoisted_7","_hoisted_8","href","_hoisted_11","_component_WatchOnButton","link","_hoisted_12","_renderList","_component_VideoItem","item","height","width","onRemove","$event","_vShow"],"mappings":"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"}