import{V as y}from"./VideoItem-BNJ24tbL.js";import{_ as f}from"./SortingSelector-tQi2cfZ5.js";import{a as v,c,w as i,b as e,d as g,k as D,v as w,F as h,f as H,r as m,h as b,o as u,g as x}from"./index-DFHtCH6M.js";import"./ModalComponent-B-ePo8ic.js";import"./CreatePlaylistModal-D_amQld8.js";import"./ConfirmModal-DRMIgDMG.js";const S={components:{VideoItem:y,SortingSelector:f},data(){return{videos:[],autoDeleteHistory:!1,autoDeleteDelayHours:"24"}},mounted(){this.autoDeleteHistory=this.getPreferenceBoolean("autoDeleteWatchHistory",!1),this.autoDeleteDelayHours=this.getPreferenceString("autoDeleteWatchHistoryDelayHours","24"),(async()=>{if(window.db&&this.getPreferenceBoolean("watchHistory",!1)){var a=window.db.transaction("watch_history","readwrite"),t=a.objectStore("watch_history");const r=t.index("watchedAt").openCursor(null,"prev");r.onsuccess=d=>{const l=d.target.result;if(l){const o=l.value;this.videos.length<1e3&&l.continue(),this.shouldRemoveVideo(o)?t.delete(o.videoId):this.videos.push({url:"/watch?v="+o.videoId,title:o.title,uploaderName:o.uploaderName,uploaderUrl:o.uploaderUrl,duration:o.duration,thumbnail:o.thumbnail,watchedAt:o.watchedAt,watched:!0,currentTime:o.currentTime})}}}})()},activated(){document.title="Watch History - Piped"},methods:{clearHistory(){if(window.db){var a=window.db.transaction("watch_history","readwrite"),t=a.objectStore("watch_history");t.clear()}this.videos=[]},exportHistory(){const a=new Date().toISOString().split(".")[0];let t={format:"Piped",version:1,playlists:[{name:"Piped History ".concat(a),type:"history",visibility:"private",videos:this.videos.map(r=>"https://youtube.com"+r.url)}]};this.download(JSON.stringify(t),"piped_history_".concat(a,".json"),"application/json")},onChange(){this.setPreference("autoDeleteWatchHistory",this.autoDeleteHistory),this.setPreference("autoDeleteWatchHistoryDelayHours",this.autoDeleteDelayHours)},shouldRemoveVideo(a){if(!this.autoDeleteHistory)return!1;let t=Number(this.autoDeleteDelayHours)*60*60*1e3;return Date.now()-a.watchedAt>t}}},k={class:"mb-3 text-center font-bold"},C={class:"flex"},V={class:"flex flex-col gap-2 md:flex-row md:items-center"},P={class:"ml-auto flex items-center gap-1"},j={class:"ml-4 flex items-center"},A={class:"ml-2",for:"autoDelete"},B={value:"1"},I={value:"3"},N={value:"6"},W={value:"12"},U={value:"24"},R={value:"72"},T={value:"168"},F={value:"336"},M={value:"672"},O={value:"1344"},q=e("hr",null,null,-1),E={class:"video-grid"},J=e("br",null,null,-1);function L(a,t,r,d,l,o){const p=m("SortingSelector"),_=m("VideoItem"),n=b("t");return u(),c(h,null,[i(e("h1",k,null,512),[[n,"titles.history"]]),e("div",C,[e("div",V,[i(e("button",{class:"btn",onClick:t[0]||(t[0]=(...s)=>o.clearHistory&&o.clearHistory(...s))},null,512),[[n,"actions.clear_history"]]),i(e("button",{class:"btn",onClick:t[1]||(t[1]=(...s)=>o.exportHistory&&o.exportHistory(...s))},null,512),[[n,"actions.export_to_json"]]),e("div",P,[g(p,{"by-key":"watchedAt",onApply:t[2]||(t[2]=s=>l.videos.sort(s))})])]),e("div",j,[i(e("input",{id:"autoDelete","onUpdate:modelValue":t[3]||(t[3]=s=>l.autoDeleteHistory=s),type:"checkbox",onChange:t[4]||(t[4]=(...s)=>o.onChange&&o.onChange(...s))},null,544),[[D,l.autoDeleteHistory]]),i(e("label",A,null,512),[[n,"actions.delete_automatically"]]),i(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.autoDeleteDelayHours=s),class:"select ml-3 pl-3",onChange:t[6]||(t[6]=(...s)=>o.onChange&&o.onChange(...s))},[i(e("option",B,null,512),[[n,{path:"info.hours",args:{amount:"1"}}]]),i(e("option",I,null,512),[[n,{path:"info.hours",args:{amount:"3"}}]]),i(e("option",N,null,512),[[n,{path:"info.hours",args:{amount:"6"}}]]),i(e("option",W,null,512),[[n,{path:"info.hours",args:{amount:"12"}}]]),i(e("option",U,null,512),[[n,{path:"info.days",args:{amount:"1"}}]]),i(e("option",R,null,512),[[n,{path:"info.days",args:{amount:"3"}}]]),i(e("option",T,null,512),[[n,{path:"info.weeks",args:{amount:"1"}}]]),i(e("option",F,null,512),[[n,{path:"info.weeks",args:{amount:"3"}}]]),i(e("option",M,null,512),[[n,{path:"info.months",args:{amount:"1"}}]]),i(e("option",O,null,512),[[n,{path:"info.months",args:{amount:"2"}}]])],544),[[w,l.autoDeleteDelayHours]])])]),q,e("div",E,[(u(!0),c(h,null,H(l.videos,s=>(u(),x(_,{key:s.url,item:s},null,8,["item"]))),128))]),J],64)}const Z=v(S,[["render",L]]);export{Z as default};
//# sourceMappingURL=HistoryPage-CWIuOrWS.js.map
