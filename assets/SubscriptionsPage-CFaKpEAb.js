import{M as y}from"./ModalComponent-B-ePo8ic.js";import{C as M}from"./CreateGroupModal-2oLKRFul.js";import{C as S}from"./ConfirmModal-DRMIgDMG.js";import{a as j,c as u,w as a,b as o,d as G,t as c,e as b,j as p,F as f,f as C,g,r as h,o as r,C as T,n as D,l as H,h as O}from"./index-DFHtCH6M.js";const E={components:{ModalComponent:y,CreateGroupModal:M,ConfirmModal:S},data(){return{subscriptions:[],selectedGroup:{groupName:"",channels:[]},channelGroups:[],showCreateGroupModal:!1,showEditGroupModal:!1,editedGroupName:"",groupToDelete:null}},computed:{filteredSubscriptions(t){return t.selectedGroup.groupName==""?t.subscriptions:t.subscriptions.filter(e=>t.selectedGroup.channels.includes(e.url.substr(-24)))}},mounted(){this.fetchSubscriptions().then(t=>{if(t.error){alert(t.error);return}this.subscriptions=t,this.subscriptions.forEach(e=>e.subscribed=!0)}),this.channelGroups.push(this.selectedGroup),window.db&&this.loadChannelGroups()},activated(){document.title="Subscriptions - Piped"},methods:{async loadChannelGroups(){const t=await this.getChannelGroups();this.channelGroups.push(...t)},handleButton(t){const e=t.url.split("/")[2];this.authenticated?this.fetchJson(this.authApiUrl()+(t.subscribed?"/unsubscribe":"/subscribe"),null,{method:"POST",body:JSON.stringify({channelId:e}),headers:{Authorization:this.getAuthToken(),"Content-Type":"application/json"}}):this.handleLocalSubscriptions(e),t.subscribed=!t.subscribed},exportHandler(){const t=[];this.subscriptions.forEach(i=>{t.push({url:"https://www.youtube.com"+i.url,name:i.name,service_id:0})});const e=JSON.stringify({app_version:"",app_version_int:0,subscriptions:t});this.download(e,"subscriptions.json","application/json")},selectGroup(t){this.selectedGroup=t,this.editedGroupName=t.groupName},createGroup(t){if(!t||this.channelGroups.some(i=>i.groupName==t))return;const e={groupName:t,channels:[]};this.channelGroups.push(e),this.createOrUpdateChannelGroup(e),this.showCreateGroupModal=!1},editGroupName(){const t=this.selectedGroup.groupName,e=this.editedGroupName;!e||e==t||this.channelGroups.some(i=>i.groupName==e)||(this.selectedGroup.groupName=e,this.createOrUpdateChannelGroup(this.selectedGroup),this.deleteChannelGroup(t),this.showEditGroupModal=!1)},deleteGroup(t){this.deleteChannelGroup(t),this.channelGroups=this.channelGroups.filter(e=>e.groupName!=t),this.selectedGroup=this.channelGroups[0]||{},this.groupToDelete=null},checkedChange(t){const e=t.url.substr(-24);this.selectedGroup.channels=this.selectedGroup.channels.includes(e)?this.selectedGroup.channels.filter(i=>i!=e):this.selectedGroup.channels.concat(e),this.createOrUpdateChannelGroup(this.selectedGroup)},async importGroupsHandler(){const t=this.$refs.fileSelector.files;for(let e of t){const i=JSON.parse(await e.text()).groups;for(let _ of i)this.createOrUpdateChannelGroup(_),this.channelGroups.push(_)}},exportGroupsHandler(){const t={format:"Piped",version:1,groups:this.channelGroups.slice(1)};this.download(JSON.stringify(t),"channel_groups.json","application/json")}}},B={class:"my-4 text-center font-bold"},U={class:"flex flex-wrap justify-between"},J={class:"flex gap-1"},V={class:"btn"},P={class:"m-1 flex flex-wrap gap-1"},A=["textContent"],I=["textContent"],z={key:0,class:"flex self-center gap-1"},F=o("br",null,null,-1),L=o("hr",null,null,-1),q={class:"w-full flex flex-wrap"},K=["onClick"],Q=["textContent"],R={key:0},W=["onClick"],X=o("i",{class:"i-fa6-solid:circle-plus"},null,-1),Y=[X],Z=o("br",null,null,-1),$=o("hr",null,null,-1),ee={class:"xl:grid xl:grid-cols-5 <md:flex-wrap"},te=["src"],se=["textContent"],oe=["onClick"],ne=o("br",null,null,-1),le={class:"mb-5 mt-3 flex justify-between"},re=["placeholder"],ie={class:"mb-2 mt-3 h-[80vh] flex flex-col overflow-y-scroll pr-2"},ue={class:"mr-3 flex items-center justify-between"},ae=["href"],ce=["src"],de={class:"ml-2"},pe=["checked","onChange"],he=o("hr",null,null,-1);function me(t,e,i,_,n,l){const x=h("router-link"),v=h("i18n-t"),w=h("ConfirmModal"),k=h("CreateGroupModal"),N=h("ModalComponent"),d=O("t");return r(),u(f,null,[a(o("h1",B,null,512),[[d,"titles.subscriptions"]]),o("div",U,[o("div",J,[o("button",V,[a(G(x,{to:"/import"},null,512),[[d,"actions.import_from_json_csv"]])]),a(o("button",{class:"btn",onClick:e[0]||(e[0]=(...s)=>l.exportHandler&&l.exportHandler(...s))},null,512),[[d,"actions.export_to_json"]])]),o("div",P,[o("div",null,[o("label",{for:"fileSelector",class:"btn",textContent:c("".concat(t.$t("actions.import_from_json")," (").concat(t.$t("titles.channel_groups"),")"))},null,8,A),o("input",{id:"fileSelector",ref:"fileSelector",type:"file",class:"hidden",multiple:"multiple",onChange:e[1]||(e[1]=(...s)=>l.importGroupsHandler&&l.importGroupsHandler(...s))},null,544)]),o("button",{class:"btn",onClick:e[2]||(e[2]=(...s)=>l.exportGroupsHandler&&l.exportGroupsHandler(...s)),textContent:c("".concat(t.$t("actions.export_to_json")," (").concat(t.$t("titles.channel_groups"),")"))},null,8,I)]),n.subscriptions.length>0?(r(),u("div",z,[G(v,{keypath:"subscriptions.subscribed_channels_count"},{default:b(()=>[T(c(n.subscriptions.length),1)]),_:1})])):p("",!0)]),F,L,o("div",q,[(r(!0),u(f,null,C(n.channelGroups,s=>(r(),u("button",{key:s.groupName,class:D(["btn mx-1 w-max",{selected:n.selectedGroup===s}]),onClick:m=>l.selectGroup(s)},[o("span",{textContent:c(s.groupName!==""?s.groupName:t.$t("video.all"))},null,8,Q),s.groupName!=""&&n.selectedGroup==s?(r(),u("div",R,[o("i",{class:"i-fa6-solid:pen mx-2",onClick:e[3]||(e[3]=m=>n.showEditGroupModal=!0)}),o("i",{class:"i-fa6-solid:circle-minus mx-2",onClick:m=>n.groupToDelete=s.groupName},null,8,W)])):p("",!0)],10,K))),128)),n.groupToDelete!=null?(r(),g(w,{key:0,message:t.$t("actions.delete_group_confirm"),onClose:e[4]||(e[4]=s=>n.groupToDelete=null),onConfirm:e[5]||(e[5]=s=>l.deleteGroup(n.groupToDelete))},null,8,["message"])):p("",!0),o("button",{class:"btn mx-1",onClick:e[6]||(e[6]=s=>n.showCreateGroupModal=!0)},Y)]),Z,$,o("div",ee,[(r(!0),u(f,null,C(l.filteredSubscriptions,s=>(r(),u("div",{key:s.url,class:"col m-2 border border-gray-500 rounded-lg p-1"},[G(x,{to:s.url,class:"text-4x4 flex p-2 font-bold"},{default:b(()=>[o("img",{src:s.avatar,class:"h-[fit-content] rounded-full",width:"48",height:"48"},null,8,te),o("span",{class:"mx-2 self-center",textContent:c(s.name)},null,8,se)]),_:2},1032,["to"]),a(o("button",{class:"btn mt-2 w-full",onClick:m=>l.handleButton(s)},null,8,oe),[[d,"actions.".concat(s.subscribed?"unsubscribe":"subscribe")]])]))),128))]),ne,n.showCreateGroupModal?(r(),g(k,{key:0,"on-create-group":l.createGroup,onClose:e[7]||(e[7]=s=>n.showCreateGroupModal=!1)},null,8,["on-create-group"])):p("",!0),n.showEditGroupModal?(r(),g(N,{key:1,onClose:e[10]||(e[10]=s=>n.showEditGroupModal=!1)},{default:b(()=>[o("div",le,[a(o("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.editedGroupName=s),type:"text",class:"input"},null,512),[[H,n.editedGroupName]]),a(o("button",{class:"btn",placeholder:t.$t("actions.group_name"),onClick:e[9]||(e[9]=s=>l.editGroupName())},null,8,re),[[d,"actions.okay"]])]),o("div",ie,[(r(!0),u(f,null,C(n.subscriptions,s=>(r(),u("div",{key:s.name},[o("div",ue,[o("a",{href:s.url,target:"_blank",class:"flex items-center overflow-hidden"},[o("img",{src:s.avatar,class:"h-8 w-8 rounded-full"},null,8,ce),o("span",de,c(s.name),1)],8,ae),o("input",{type:"checkbox",class:"checkbox",checked:n.selectedGroup.channels.includes(s.url.substr(-24)),onChange:m=>l.checkedChange(s)},null,40,pe)]),he]))),128))])]),_:1})):p("",!0)],64)}const Ce=j(E,[["render",me]]);export{Ce as default};
//# sourceMappingURL=SubscriptionsPage-CFaKpEAb.js.map
