import{_ as S}from"./ContentItem-BvthkZQ-.js";import{L as C}from"./LoadingIndicatorPage-D98bvYGK.js";import{a as F,c as u,b as l,t as c,w as y,v as $,F as h,f as p,d,e as _,j as k,r as a,o as n,g as R,h as b}from"./index-DFHtCH6M.js";const I={components:{ContentItem:S,LoadingIndicatorPage:C},data(){var e;return{results:null,availableFilters:["all","videos","channels","playlists","music_songs","music_videos","music_albums","music_playlists","music_artists"],selectedFilter:(e=this.$route.query.filter)!=null?e:"all"}},mounted(){this.handleRedirect()||(this.updateResults(),this.saveQueryToHistory())},updated(){this.$route.query.search_query!==void 0&&(document.title=this.$route.query.search_query+" - Piped")},activated(){this.handleRedirect(),window.addEventListener("scroll",this.handleScroll)},deactivated(){window.removeEventListener("scroll",this.handleScroll)},unmounted(){window.removeEventListener("scroll",this.handleScroll)},methods:{async fetchResults(){var e;return await await this.fetchJson(this.apiUrl()+"/search",{q:this.$route.query.search_query,filter:(e=this.$route.query.filter)!=null?e:"all"})},async updateResults(){document.title=this.$route.query.search_query+" - Piped",this.results=this.fetchResults().then(e=>{this.results=e,this.updateWatched(this.results.items)})},updateFilter(){this.$router.replace({query:{search_query:this.$route.query.search_query,filter:this.selectedFilter}})},handleScroll(){var e;this.loading||!this.results||!this.results.nextpage||window.innerHeight+window.scrollY>=document.body.offsetHeight-window.innerHeight&&(this.loading=!0,this.fetchJson(this.apiUrl()+"/nextpage/search",{nextpage:this.results.nextpage,q:this.$route.query.search_query,filter:(e=this.$route.query.filter)!=null?e:"all"}).then(t=>{this.results.nextpage=t.nextpage,this.results.id=t.id,this.loading=!1,t.items.map(i=>this.results.items.push(i))}))},handleRedirect(){var i,o,s;const e=this.$route.query.search_query,t=(s=(i=/(?:http(?:s)?:\/\/)?(?:www\.)?youtube\.com(\/[/a-zA-Z0-9_?=&-]*)/gm.exec(e))==null?void 0:i[1])!=null?s:(o=/(?:http(?:s)?:\/\/)?(?:www\.)?youtu\.be\/(?:watch\?v=)?([/a-zA-Z0-9_?=&-]*)/gm.exec(e))==null?void 0:o[1].replace(/^/,"/watch?v=");if(t)return this.$router.push(t),!0},saveQueryToHistory(){var i;if(!this.getPreferenceBoolean("searchHistory",!1))return;const e=this.$route.query.search_query;if(!e)return;const t=(i=JSON.parse(localStorage.getItem("search_history")))!=null?i:[];if(t.includes(e)){const o=t.indexOf(e);t.splice(o,1)}t.unshift(e),t.length>10&&t.shift(),localStorage.setItem("search_history",JSON.stringify(t))}}},L=["textContent"],H={for:"ddlSearchFilters"},P=["textContent"],B=["value"],N=l("hr",null,null,-1),E={key:0},J=["textContent"];function V(e,t,i,o,s,f){var m;const g=a("router-link"),q=a("i18n-t"),w=a("ContentItem"),v=a("LoadingIndicatorPage"),x=b("t");return n(),u(h,null,[l("h1",{class:"my-2 text-center",textContent:c(e.$route.query.search_query)},null,8,L),l("label",H,[l("strong",{textContent:c("".concat(e.$t("actions.filter"),":"))},null,8,P)]),y(l("select",{id:"ddlSearchFilters","onUpdate:modelValue":t[0]||(t[0]=r=>s.selectedFilter=r),default:"all",class:"select w-auto",onChange:t[1]||(t[1]=r=>f.updateFilter())},[(n(!0),u(h,null,p(s.availableFilters,r=>y((n(),u("option",{key:r,value:r},null,8,B)),[[x,"search.".concat(r)]])),128))],544),[[$,s.selectedFilter]]),N,s.results&&s.results.corrected?(n(),u("div",E,[d(q,{keypath:"search.did_you_mean",tag:"div",class:"text-lg"},{default:_(()=>[d(g,{to:{name:"SearchResults",query:{search_query:s.results.suggestion}}},{default:_(()=>[l("em",{textContent:c(s.results.suggestion)},null,8,J)]),_:1},8,["to"])]),_:1})])):k("",!0),d(v,{"show-content":s.results!=null&&((m=s.results.items)==null?void 0:m.length),class:"video-grid"},{default:_(()=>[(n(!0),u(h,null,p(s.results.items,r=>(n(),R(w,{key:r.url,item:r,height:"94",width:"168"},null,8,["item"]))),128))]),_:1},8,["show-content"])],64)}const z=F(I,[["render",V]]);export{z as default};
//# sourceMappingURL=SearchResults-C-VPtxqo.js.map
