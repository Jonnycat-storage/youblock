{"version":3,"file":"PlaylistPage-DcL8Llqv.js","sources":["../../src/components/PlaylistPage.vue"],"sourcesContent":["<template>\n    <ErrorHandler v-if=\"playlist && playlist.error\" :message=\"playlist.message\" :error=\"playlist.error\" />\n\n    <LoadingIndicatorPage v-show=\"!playlist?.error\" :show-content=\"playlist\">\n        <h1 class=\"mb-1 ml-1 mt-4 text-3xl!\" v-text=\"playlist.name\" />\n\n        <CollapsableText v-if=\"playlist?.description\" :text=\"playlist.description\" />\n\n        <div class=\"mt-1 flex justify-between <md:flex-col md:items-center\">\n            <div>\n                <router-link class=\"link flex items-center gap-3\" :to=\"playlist.uploaderUrl || '/'\">\n                    <img loading=\"lazy\" :src=\"playlist.uploaderAvatar\" class=\"h-12 rounded-full\" />\n                    <strong v-text=\"playlist.uploader\" />\n                </router-link>\n            </div>\n            <div class=\"flex flex-wrap items-center gap-1\">\n                <strong\n                    v-text=\"\n                        `${playlist.videos} ${$t('video.videos')} - ${timeFormat(totalDuration)}${playlist.nextpage ? '+' : ''}`\n                    \"\n                />\n                <button v-if=\"!isPipedPlaylist\" class=\"btn mx-1\" @click=\"bookmarkPlaylist\">\n                    {{ $t(`actions.${isBookmarked ? \"playlist_bookmarked\" : \"bookmark_playlist\"}`)\n                    }}<i class=\"i-fa6-solid:bookmark ml-3\" />\n                </button>\n                <button v-if=\"authenticated && !isPipedPlaylist\" class=\"btn mr-1\" @click=\"clonePlaylist\">\n                    {{ $t(\"actions.clone_playlist\") }}<i class=\"i-fa6-solid:clone ml-3\" />\n                </button>\n                <button class=\"btn mr-1\" @click=\"downloadPlaylistAsTxt\">\n                    {{ $t(\"actions.download_as_txt\") }}\n                </button>\n                <a class=\"btn mr-1\" :href=\"getRssUrl\">\n                    <i class=\"i-fa6-solid:rss\" />\n                </a>\n                <WatchOnButton :link=\"`https://www.youtube.com/playlist?list=${$route.query.list}`\" />\n            </div>\n        </div>\n\n        <hr />\n\n        <div class=\"video-grid\">\n            <VideoItem\n                v-for=\"(video, index) in playlist.relatedStreams\"\n                :key=\"video.url\"\n                :item=\"video\"\n                :index=\"index\"\n                :playlist-id=\"$route.query.list\"\n                :admin=\"admin\"\n                height=\"94\"\n                width=\"168\"\n                @remove=\"removeVideo(index)\"\n            />\n        </div>\n    </LoadingIndicatorPage>\n</template>\n\n<script>\nimport ErrorHandler from \"./ErrorHandler.vue\";\nimport LoadingIndicatorPage from \"./LoadingIndicatorPage.vue\";\nimport CollapsableText from \"./CollapsableText.vue\";\nimport VideoItem from \"./VideoItem.vue\";\nimport WatchOnButton from \"./WatchOnButton.vue\";\n\nexport default {\n    components: {\n        ErrorHandler,\n        VideoItem,\n        WatchOnButton,\n        LoadingIndicatorPage,\n        CollapsableText,\n    },\n    data() {\n        return {\n            playlist: null,\n            totalDuration: 0,\n            admin: false,\n            isBookmarked: false,\n        };\n    },\n    computed: {\n        getRssUrl: _this => {\n            return _this.authApiUrl() + \"/rss/playlists/\" + _this.$route.query.list;\n        },\n        isPipedPlaylist: _this => {\n            // regex to determine whether it's a Piped plalylist\n            return /[\\da-fA-F]{8}-[\\da-fA-F]{4}-[\\da-fA-F]{4}-[\\da-fA-F]{4}-[\\da-fA-F]{12}/.test(\n                _this.$route.query.list,\n            );\n        },\n    },\n    mounted() {\n        const playlistId = this.$route.query.list;\n        if (this.authenticated && playlistId?.length == 36)\n            this.getPlaylists().then(json => {\n                if (json.error) alert(json.error);\n                else if (json.some(playlist => playlist.id === playlistId)) this.admin = true;\n            });\n        else if (playlistId.startsWith(\"local\")) this.admin = true;\n        this.isPlaylistBookmarked();\n    },\n    activated() {\n        this.getPlaylistData();\n        window.addEventListener(\"scroll\", this.handleScroll);\n        if (this.playlist) this.updateTitle();\n    },\n    deactivated() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    methods: {\n        async getPlaylistData() {\n            this.getPlaylist(this.$route.query.list)\n                .then(data => (this.playlist = data))\n                .then(() => {\n                    this.updateTitle();\n                    this.updateTotalDuration();\n                    this.updateWatched(this.playlist.relatedStreams);\n                    this.fetchDeArrowContent(this.playlist.relatedStreams);\n                });\n        },\n        async updateTitle() {\n            document.title = this.playlist.name + \" - Piped\";\n        },\n        handleScroll() {\n            if (this.loading || !this.playlist || !this.playlist.nextpage) return;\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - window.innerHeight) {\n                this.loading = true;\n                this.fetchJson(this.authApiUrl() + \"/nextpage/playlists/\" + this.$route.query.list, {\n                    nextpage: this.playlist.nextpage,\n                }).then(json => {\n                    this.playlist.nextpage = json.nextpage;\n                    this.loading = false;\n                    this.playlist.relatedStreams.push(...json.relatedStreams);\n                    this.updateTotalDuration();\n                    this.fetchDeArrowContent(json.relatedStreams);\n                });\n            }\n        },\n        removeVideo(index) {\n            this.playlist.relatedStreams.splice(index, 1);\n        },\n        updateTotalDuration() {\n            this.totalDuration = this.playlist.relatedStreams.map(video => video.duration).reduce((a, b) => a + b);\n        },\n        async clonePlaylist() {\n            this.fetchJson(this.authApiUrl() + \"/import/playlist\", null, {\n                method: \"POST\",\n                headers: {\n                    Authorization: this.getAuthToken(),\n                },\n                body: JSON.stringify({\n                    playlistId: this.$route.query.list,\n                }),\n            }).then(resp => {\n                if (!resp.error) {\n                    alert(this.$t(\"actions.clone_playlist_success\"));\n                } else alert(resp.error);\n            });\n        },\n        downloadPlaylistAsTxt() {\n            const data = this.playlist.relatedStreams\n                .map(video => {\n                    return \"https://piped.video\" + video.url;\n                })\n                .join(\"\\n\");\n            this.download(data, this.playlist.name + \".txt\", \"text/plain\");\n        },\n        async bookmarkPlaylist() {\n            if (!this.playlist) return;\n\n            if (this.isBookmarked) {\n                this.removePlaylistBookmark();\n                return;\n            }\n\n            if (window.db) {\n                const playlistId = this.$route.query.list;\n                var tx = window.db.transaction(\"playlist_bookmarks\", \"readwrite\");\n                var store = tx.objectStore(\"playlist_bookmarks\");\n                store.put({\n                    playlistId: playlistId,\n                    name: this.playlist.name,\n                    uploader: this.playlist.uploader,\n                    uploaderUrl: this.playlist.uploaderUrl,\n                    thumbnail: this.playlist.thumbnailUrl,\n                    uploaderAvatar: this.playlist.uploaderAvatar,\n                    videos: this.playlist.videos,\n                });\n                this.isBookmarked = true;\n            }\n        },\n        async removePlaylistBookmark() {\n            var tx = window.db.transaction(\"playlist_bookmarks\", \"readwrite\");\n            var store = tx.objectStore(\"playlist_bookmarks\");\n            store.delete(this.$route.query.list);\n            this.isBookmarked = false;\n        },\n        async isPlaylistBookmarked() {\n            // needed in order to change the is bookmarked var later\n            const App = this;\n            const playlistId = this.$route.query.list;\n            var tx = window.db.transaction(\"playlist_bookmarks\", \"readwrite\");\n            var store = tx.objectStore(\"playlist_bookmarks\");\n            var req = store.openCursor(playlistId);\n            req.onsuccess = function (e) {\n                var cursor = e.target.result;\n                App.isBookmarked = cursor ? true : false;\n            };\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","ErrorHandler","VideoItem","WatchOnButton","LoadingIndicatorPage","CollapsableText","_this","playlistId","json","playlist","data","index","video","a","b","resp","tx","store","App","req","e","cursor","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_createElementVNode","_hoisted_9","_hoisted_10","_hoisted_13","_openBlock","_createElementBlock","_Fragment","$data","_createBlock","_component_ErrorHandler","_createCommentVNode","_createVNode","_component_LoadingIndicatorPage","_withCtx","_toDisplayString","_a","_component_CollapsableText","_component_router_link","_ctx","$options","args","_createTextVNode","_hoisted_7","_hoisted_8","_hoisted_11","_component_WatchOnButton","_hoisted_12","_renderList","_component_VideoItem","$event","_vShow"],"mappings":"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"}