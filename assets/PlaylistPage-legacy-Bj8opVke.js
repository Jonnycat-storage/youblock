System.register(["./WatchOnButton-legacy-GiW_Hk0q.js","./LoadingIndicatorPage-legacy-rxdJgMZA.js","./VideoItem-legacy-DDmFzm8y.js","./index-legacy-CmTDz3X_.js","./ModalComponent-legacy-BmTvlHoT.js","./CreatePlaylistModal-legacy-Bg0tm0yq.js","./ConfirmModal-legacy-CnRD7ob6.js"],(function(t,l){"use strict";var e,s,a,i,o,r,n,d,y,u,p,h,c,m,k,g,w,b,f,x;return{setters:[t=>{e=t.E,s=t.W,a=t.C},t=>{i=t.L},t=>{o=t.V},t=>{r=t.a,n=t.c,d=t.g,y=t.j,u=t.w,p=t.B,h=t.d,c=t.e,m=t.F,k=t.r,g=t.o,w=t.b,b=t.t,f=t.C,x=t.f},null,null,null],execute:function(){const l={components:{ErrorHandler:e,VideoItem:o,WatchOnButton:s,LoadingIndicatorPage:i,CollapsableText:a},data:()=>({playlist:null,totalDuration:0,admin:!1,isBookmarked:!1}),computed:{getRssUrl:t=>t.authApiUrl()+"/rss/playlists/"+t.$route.query.list,isPipedPlaylist:t=>/[\da-fA-F]{8}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{4}-[\da-fA-F]{12}/.test(t.$route.query.list)},mounted(){const t=this.$route.query.list;this.authenticated&&36==t?.length?this.getPlaylists().then((l=>{l.error?alert(l.error):l.some((l=>l.id===t))&&(this.admin=!0)})):t.startsWith("local")&&(this.admin=!0),this.isPlaylistBookmarked()},activated(){this.getPlaylistData(),window.addEventListener("scroll",this.handleScroll),this.playlist&&this.updateTitle()},deactivated(){window.removeEventListener("scroll",this.handleScroll)},methods:{async getPlaylistData(){this.getPlaylist(this.$route.query.list).then((t=>this.playlist=t)).then((()=>{this.updateTitle(),this.updateTotalDuration(),this.updateWatched(this.playlist.relatedStreams),this.fetchDeArrowContent(this.playlist.relatedStreams)}))},async updateTitle(){document.title=this.playlist.name+" - Piped"},handleScroll(){!this.loading&&this.playlist&&this.playlist.nextpage&&window.innerHeight+window.scrollY>=document.body.offsetHeight-window.innerHeight&&(this.loading=!0,this.fetchJson(this.authApiUrl()+"/nextpage/playlists/"+this.$route.query.list,{nextpage:this.playlist.nextpage}).then((t=>{this.playlist.nextpage=t.nextpage,this.loading=!1,this.playlist.relatedStreams.push(...t.relatedStreams),this.updateTotalDuration(),this.fetchDeArrowContent(t.relatedStreams)})))},removeVideo(t){this.playlist.relatedStreams.splice(t,1)},updateTotalDuration(){this.totalDuration=this.playlist.relatedStreams.map((t=>t.duration)).reduce(((t,l)=>t+l))},async clonePlaylist(){this.fetchJson(this.authApiUrl()+"/import/playlist",null,{method:"POST",headers:{Authorization:this.getAuthToken()},body:JSON.stringify({playlistId:this.$route.query.list})}).then((t=>{t.error?alert(t.error):alert(this.$t("actions.clone_playlist_success"))}))},downloadPlaylistAsTxt(){const t=this.playlist.relatedStreams.map((t=>"https://piped.video"+t.url)).join("\n");this.download(t,this.playlist.name+".txt","text/plain")},async bookmarkPlaylist(){if(this.playlist)if(this.isBookmarked)this.removePlaylistBookmark();else if(window.db){const t=this.$route.query.list;window.db.transaction("playlist_bookmarks","readwrite").objectStore("playlist_bookmarks").put({playlistId:t,name:this.playlist.name,uploader:this.playlist.uploader,uploaderUrl:this.playlist.uploaderUrl,thumbnail:this.playlist.thumbnailUrl,uploaderAvatar:this.playlist.uploaderAvatar,videos:this.playlist.videos}),this.isBookmarked=!0}},async removePlaylistBookmark(){window.db.transaction("playlist_bookmarks","readwrite").objectStore("playlist_bookmarks").delete(this.$route.query.list),this.isBookmarked=!1},async isPlaylistBookmarked(){const t=this,l=this.$route.query.list;window.db.transaction("playlist_bookmarks","readwrite").objectStore("playlist_bookmarks").openCursor(l).onsuccess=function(l){var e=l.target.result;t.isBookmarked=!!e}}}},P=["textContent"],v={class:"mt-1 flex justify-between <md:flex-col md:items-center"},$=["src"],C=["textContent"],A={class:"flex flex-wrap items-center gap-1"},S=["textContent"],_=w("i",{class:"i-fa6-solid:bookmark ml-3"},null,-1),B=w("i",{class:"i-fa6-solid:clone ml-3"},null,-1),j=["href"],T=[w("i",{class:"i-fa6-solid:rss"},null,-1)],q=w("hr",null,null,-1),D={class:"video-grid"};t("default",r(l,[["render",function(t,l,e,s,a,i){const o=k("ErrorHandler"),r=k("CollapsableText"),I=k("router-link"),U=k("WatchOnButton"),F=k("VideoItem"),L=k("LoadingIndicatorPage");return g(),n(m,null,[a.playlist&&a.playlist.error?(g(),d(o,{key:0,message:a.playlist.message,error:a.playlist.error},null,8,["message","error"])):y("",!0),u(h(L,{"show-content":a.playlist},{default:c((()=>[w("h1",{class:"mb-1 ml-1 mt-4 text-3xl!",textContent:b(a.playlist.name)},null,8,P),a.playlist?.description?(g(),d(r,{key:0,text:a.playlist.description},null,8,["text"])):y("",!0),w("div",v,[w("div",null,[h(I,{class:"link flex items-center gap-3",to:a.playlist.uploaderUrl||"/"},{default:c((()=>[w("img",{loading:"lazy",src:a.playlist.uploaderAvatar,class:"h-12 rounded-full"},null,8,$),w("strong",{textContent:b(a.playlist.uploader)},null,8,C)])),_:1},8,["to"])]),w("div",A,[w("strong",{textContent:b(`${a.playlist.videos} ${t.$t("video.videos")} - ${t.timeFormat(a.totalDuration)}${a.playlist.nextpage?"+":""}`)},null,8,S),i.isPipedPlaylist?y("",!0):(g(),n("button",{key:0,class:"btn mx-1",onClick:l[0]||(l[0]=(...t)=>i.bookmarkPlaylist&&i.bookmarkPlaylist(...t))},[f(b(t.$t("actions."+(a.isBookmarked?"playlist_bookmarked":"bookmark_playlist"))),1),_])),t.authenticated&&!i.isPipedPlaylist?(g(),n("button",{key:1,class:"btn mr-1",onClick:l[1]||(l[1]=(...t)=>i.clonePlaylist&&i.clonePlaylist(...t))},[f(b(t.$t("actions.clone_playlist")),1),B])):y("",!0),w("button",{class:"btn mr-1",onClick:l[2]||(l[2]=(...t)=>i.downloadPlaylistAsTxt&&i.downloadPlaylistAsTxt(...t))},b(t.$t("actions.download_as_txt")),1),w("a",{class:"btn mr-1",href:i.getRssUrl},T,8,j),h(U,{link:`https://www.youtube.com/playlist?list=${t.$route.query.list}`},null,8,["link"])])]),q,w("div",D,[(g(!0),n(m,null,x(a.playlist.relatedStreams,((l,e)=>(g(),d(F,{key:l.url,item:l,index:e,"playlist-id":t.$route.query.list,admin:a.admin,height:"94",width:"168",onRemove:t=>i.removeVideo(e)},null,8,["item","index","playlist-id","admin","onRemove"])))),128))])])),_:1},8,["show-content"]),[[p,!a.playlist?.error]])],64)}]]))}}}));
//# sourceMappingURL=PlaylistPage-legacy-Bj8opVke.js.map
