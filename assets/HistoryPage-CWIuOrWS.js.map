{"version":3,"file":"HistoryPage-CWIuOrWS.js","sources":["../../src/components/HistoryPage.vue"],"sourcesContent":["<template>\n    <h1 v-t=\"'titles.history'\" class=\"mb-3 text-center font-bold\" />\n\n    <div class=\"flex\">\n        <div class=\"flex flex-col gap-2 md:flex-row md:items-center\">\n            <button v-t=\"'actions.clear_history'\" class=\"btn\" @click=\"clearHistory\" />\n\n            <button v-t=\"'actions.export_to_json'\" class=\"btn\" @click=\"exportHistory\" />\n\n            <div class=\"ml-auto flex items-center gap-1\">\n                <SortingSelector by-key=\"watchedAt\" @apply=\"order => videos.sort(order)\" />\n            </div>\n        </div>\n\n        <div class=\"ml-4 flex items-center\">\n            <input id=\"autoDelete\" v-model=\"autoDeleteHistory\" type=\"checkbox\" @change=\"onChange\" />\n            <label v-t=\"'actions.delete_automatically'\" class=\"ml-2\" for=\"autoDelete\" />\n            <select v-model=\"autoDeleteDelayHours\" class=\"select ml-3 pl-3\" @change=\"onChange\">\n                <option v-t=\"{ path: 'info.hours', args: { amount: '1' } }\" value=\"1\" />\n                <option v-t=\"{ path: 'info.hours', args: { amount: '3' } }\" value=\"3\" />\n                <option v-t=\"{ path: 'info.hours', args: { amount: '6' } }\" value=\"6\" />\n                <option v-t=\"{ path: 'info.hours', args: { amount: '12' } }\" value=\"12\" />\n                <option v-t=\"{ path: 'info.days', args: { amount: '1' } }\" value=\"24\" />\n                <option v-t=\"{ path: 'info.days', args: { amount: '3' } }\" value=\"72\" />\n                <option v-t=\"{ path: 'info.weeks', args: { amount: '1' } }\" value=\"168\" />\n                <option v-t=\"{ path: 'info.weeks', args: { amount: '3' } }\" value=\"336\" />\n                <option v-t=\"{ path: 'info.months', args: { amount: '1' } }\" value=\"672\" />\n                <option v-t=\"{ path: 'info.months', args: { amount: '2' } }\" value=\"1344\" />\n            </select>\n        </div>\n    </div>\n\n    <hr />\n\n    <div class=\"video-grid\">\n        <VideoItem v-for=\"video in videos\" :key=\"video.url\" :item=\"video\" />\n    </div>\n\n    <br />\n</template>\n\n<script>\nimport VideoItem from \"./VideoItem.vue\";\nimport SortingSelector from \"./SortingSelector.vue\";\n\nexport default {\n    components: {\n        VideoItem,\n        SortingSelector,\n    },\n    data() {\n        return {\n            videos: [],\n            autoDeleteHistory: false,\n            autoDeleteDelayHours: \"24\",\n        };\n    },\n    mounted() {\n        this.autoDeleteHistory = this.getPreferenceBoolean(\"autoDeleteWatchHistory\", false);\n        this.autoDeleteDelayHours = this.getPreferenceString(\"autoDeleteWatchHistoryDelayHours\", \"24\");\n\n        (async () => {\n            if (window.db && this.getPreferenceBoolean(\"watchHistory\", false)) {\n                var tx = window.db.transaction(\"watch_history\", \"readwrite\");\n                var store = tx.objectStore(\"watch_history\");\n                const cursorRequest = store.index(\"watchedAt\").openCursor(null, \"prev\");\n                cursorRequest.onsuccess = e => {\n                    const cursor = e.target.result;\n                    if (cursor) {\n                        const video = cursor.value;\n                        if (this.videos.length < 1000) cursor.continue();\n                        if (!this.shouldRemoveVideo(video)) {\n                            this.videos.push({\n                                url: \"/watch?v=\" + video.videoId,\n                                title: video.title,\n                                uploaderName: video.uploaderName,\n                                uploaderUrl: video.uploaderUrl,\n                                duration: video.duration,\n                                thumbnail: video.thumbnail,\n                                watchedAt: video.watchedAt,\n                                watched: true,\n                                currentTime: video.currentTime,\n                            });\n                        } else {\n                            store.delete(video.videoId);\n                        }\n                    }\n                };\n            }\n        })();\n    },\n    activated() {\n        document.title = \"Watch History - Piped\";\n    },\n    methods: {\n        clearHistory() {\n            if (window.db) {\n                var tx = window.db.transaction(\"watch_history\", \"readwrite\");\n                var store = tx.objectStore(\"watch_history\");\n                store.clear();\n            }\n            this.videos = [];\n        },\n        exportHistory() {\n            const dateStr = new Date().toISOString().split(\".\")[0];\n            let json = {\n                format: \"Piped\",\n                version: 1,\n                playlists: [\n                    {\n                        name: `Piped History ${dateStr}`,\n                        type: \"history\",\n                        visibility: \"private\",\n                        videos: this.videos.map(video => \"https://youtube.com\" + video.url),\n                    },\n                ],\n            };\n            this.download(JSON.stringify(json), `piped_history_${dateStr}.json`, \"application/json\");\n        },\n        onChange() {\n            this.setPreference(\"autoDeleteWatchHistory\", this.autoDeleteHistory);\n            this.setPreference(\"autoDeleteWatchHistoryDelayHours\", this.autoDeleteDelayHours);\n        },\n        shouldRemoveVideo(video) {\n            if (!this.autoDeleteHistory) return false;\n            // convert from hours to milliseconds\n            let maximumTimeDiff = Number(this.autoDeleteDelayHours) * 60 * 60 * 1000;\n            return Date.now() - video.watchedAt > maximumTimeDiff;\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","VideoItem","SortingSelector","tx","store","cursorRequest","e","cursor","video","dateStr","json","maximumTimeDiff","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_createElementVNode","_hoisted_18","_openBlock","_createElementBlock","_Fragment","_withDirectives","$options","args","_createVNode","_component_SortingSelector","order","$data","_cache","$event","_hoisted_6","_hoisted_17","_renderList","_createBlock","_component_VideoItem","_hoisted_19"],"mappings":"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"}