{"version":3,"file":"FeedPage-legacy-U3hHs_o6.js","sources":["../../src/components/FeedPage.vue"],"sourcesContent":["<template>\n    <h1 v-t=\"'titles.feed'\" class=\"my-4 text-center font-bold\" />\n\n    <div class=\"flex flex-col flex-wrap gap-2 children:(flex items-center gap-1) md:flex-row md:items-center\">\n        <span>\n            <label for=\"filters\">\n                <strong v-text=\"`${$t('actions.filter')}:`\" />\n            </label>\n            <select\n                id=\"filters\"\n                v-model=\"selectedFilter\"\n                default=\"all\"\n                class=\"select flex-grow\"\n                @change=\"onFilterChange()\"\n            >\n                <option v-for=\"filter in availableFilters\" :key=\"filter\" v-t=\"`video.${filter}`\" :value=\"filter\" />\n            </select>\n        </span>\n\n        <span>\n            <label for=\"group-selector\">\n                <strong v-text=\"`${$t('titles.channel_groups')}:`\" />\n            </label>\n            <select id=\"group-selector\" v-model=\"selectedGroupName\" default=\"\" class=\"select flex-grow\">\n                <option v-t=\"`video.all`\" value=\"\" />\n                <option\n                    v-for=\"group in channelGroups\"\n                    :key=\"group.groupName\"\n                    :value=\"group.groupName\"\n                    v-text=\"group.groupName\"\n                />\n            </select>\n        </span>\n\n        <span class=\"md:ml-auto\">\n            <SortingSelector by-key=\"uploaded\" @apply=\"order => videos.sort(order)\" />\n        </span>\n    </div>\n    <hr />\n\n    <span class=\"flex gap-2\">\n        <router-link v-t=\"'titles.subscriptions'\" class=\"btn\" to=\"/subscriptions\" />\n        <a :href=\"getRssUrl\" class=\"btn\">\n            <i class=\"i-fa6-solid:rss\" />\n        </a>\n    </span>\n    <hr />\n\n    <LoadingIndicatorPage :show-content=\"videosStore != null\" class=\"video-grid\">\n        <template v-for=\"video in filteredVideos\" :key=\"video.url\">\n            <VideoItem v-if=\"shouldShowVideo(video)\" :is-feed=\"true\" :item=\"video\" />\n        </template>\n    </LoadingIndicatorPage>\n</template>\n\n<script>\nimport VideoItem from \"./VideoItem.vue\";\nimport SortingSelector from \"./SortingSelector.vue\";\nimport LoadingIndicatorPage from \"./LoadingIndicatorPage.vue\";\n\nexport default {\n    components: {\n        VideoItem,\n        SortingSelector,\n        LoadingIndicatorPage,\n    },\n    data() {\n        return {\n            currentVideoCount: 0,\n            videoStep: 100,\n            videosStore: null,\n            videos: [],\n            availableFilters: [\"all\", \"shorts\", \"videos\"],\n            selectedFilter: \"all\",\n            selectedGroupName: \"\",\n            channelGroups: [],\n        };\n    },\n    computed: {\n        getRssUrl(_this) {\n            if (_this.authenticated) return _this.authApiUrl() + \"/feed/rss?authToken=\" + _this.getAuthToken();\n            else return _this.authApiUrl() + \"/feed/unauthenticated/rss?channels=\" + _this.getUnauthenticatedChannels();\n        },\n        filteredVideos(_this) {\n            const selectedGroup = _this.channelGroups.filter(group => group.groupName == _this.selectedGroupName);\n\n            const videos = this.getPreferenceBoolean(\"hideWatched\", false)\n                ? this.videos.filter(video => !video.watched)\n                : this.videos;\n\n            return _this.selectedGroupName == \"\"\n                ? videos\n                : videos.filter(video => selectedGroup[0].channels.includes(video.uploaderUrl.substr(-24)));\n        },\n    },\n    mounted() {\n        this.fetchFeed().then(resp => {\n            if (resp.error) {\n                alert(resp.error);\n                return;\n            }\n\n            this.videosStore = resp;\n            this.loadMoreVideos();\n            this.updateWatched(this.videos);\n        });\n\n        this.selectedFilter = this.getPreferenceString(\"feedFilter\") ?? \"all\";\n\n        if (!window.db) return;\n\n        this.loadChannelGroups();\n    },\n    activated() {\n        document.title = this.$t(\"titles.feed\") + \" - Piped\";\n        if (this.videos.length > 0) this.updateWatched(this.videos);\n        window.addEventListener(\"scroll\", this.handleScroll);\n    },\n    deactivated() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    unmounted() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    methods: {\n        async loadChannelGroups() {\n            const groups = await this.getChannelGroups();\n            this.channelGroups.push(...groups);\n        },\n        loadMoreVideos() {\n            if (!this.videosStore) return;\n            this.currentVideoCount = Math.min(this.currentVideoCount + this.videoStep, this.videosStore.length);\n            if (this.videos.length != this.videosStore.length) {\n                this.fetchDeArrowContent(this.videosStore.slice(this.videos.length, this.currentVideoCount));\n                this.videos = this.videosStore.slice(0, this.currentVideoCount);\n            }\n        },\n        handleScroll() {\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - window.innerHeight) {\n                this.loadMoreVideos();\n            }\n        },\n        shouldShowVideo(video) {\n            switch (this.selectedFilter.toLowerCase()) {\n                case \"shorts\":\n                    return video.isShort;\n                case \"videos\":\n                    return !video.isShort;\n                default:\n                    return true;\n            }\n        },\n        onFilterChange() {\n            this.setPreference(\"feedFilter\", this.selectedFilter);\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","components","VideoItem","SortingSelector","LoadingIndicatorPage","data","currentVideoCount","videoStep","videosStore","videos","availableFilters","selectedFilter","selectedGroupName","channelGroups","computed","getRssUrl","_this","authenticated","authApiUrl","getAuthToken","getUnauthenticatedChannels","filteredVideos","selectedGroup","filter","group","groupName","this","getPreferenceBoolean","video","watched","channels","includes","uploaderUrl","substr","mounted","fetchFeed","then","resp","error","alert","loadMoreVideos","updateWatched","getPreferenceString","window","db","loadChannelGroups","activated","document","title","$t","length","addEventListener","handleScroll","deactivated","removeEventListener","unmounted","methods","groups","getChannelGroups","push","Math","min","fetchDeArrowContent","slice","innerHeight","scrollY","body","offsetHeight","shouldShowVideo","toLowerCase","isShort","onFilterChange","setPreference","_hoisted_1","class","_hoisted_2","_hoisted_3","for","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","value","_hoisted_9","_hoisted_10","_createElementVNode","_hoisted_12","_hoisted_13","_openBlock","_createElementBlock","_Fragment","_withDirectives","textContent","_toDisplayString","_ctx","id","_cache","$event","$data","default","onChange","$options","_renderList","key","_createVNode","_component_SortingSelector","onApply","order","sort","_hoisted_11","_component_router_link","to","href","_hoisted_15","_hoisted_16","_component_LoadingIndicatorPage","_withCtx","url","_createBlock","_component_VideoItem","item","_createCommentVNode","_"],"mappings":"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"}