{"version":3,"file":"registerServiceWorker-legacy-Cjzh-vIa.js","sources":["../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/registerServiceWorker.js"],"sourcesContent":["// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      await sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = async () => {\n        await wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                if (event.isExternal)\n                  window.location.reload();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n          wb.addEventListener(\"externalwaiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","/* eslint-disable no-console */\n\nimport { registerSW } from \"virtual:pwa-register\";\n\nif (process.env.NODE_ENV === \"production\") {\n    registerSW();\n}\n"],"names":["options","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","async","navigator","__vitePreload","Workbox","module","import","then","scope","type","catch","e","addEventListener","event","isUpdate","isExternal","window","location","reload","register","r","registerSW"],"mappings":"iIAKA,SAAoBA,EAAU,IAC5B,MAAMC,UACJA,GAAY,EAAKC,cACjBA,EAAaC,eACbA,EAAcC,aACdA,EAAYC,eACZA,EAAcC,gBACdA,GACEN,EACJ,IAAIO,EACAC,EAyEJA,EAjEAC,iBACE,GAAI,kBAAmBC,UAAW,CAOhC,GANAH,QAAUI,GAAAF,UAAA,MAAAG,QAAAA,SAACC,EAAOC,OAAA,gDAAiB,MAAA,CAAAF,UAAA,QAAA,GAACG,MAAK,EAAGH,aAC/B,IAAAA,EAAQ,SAAU,CAAEI,MAAO,IAAKC,KAAM,cAChDC,OAAOC,IACRb,IAAkBa,EACL,KAEVZ,EACH,OAMEA,EAAGa,iBAAiB,aAAcC,KAC5BA,EAAMC,UAAYD,EAAME,aAC1BC,OAAOC,SAASC,QAAQ,IAE5BnB,EAAGa,iBAAiB,aAAcC,IAC3BA,EAAMC,UACTnB,KACD,IAiCPI,EAAGoB,SAAS,CAAE1B,cAAac,MAAMa,IAC3BvB,EACFA,EAAe,SAAUuB,GAEzBxB,IAAewB,EAAE,IAClBV,OAAOC,IACRb,IAAkBa,EAAE,GAEvB,CACF,CACiBQ,EAEpB,CCrFeE"}