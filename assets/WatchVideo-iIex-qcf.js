const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DFHtCH6M.js","assets/index-BMArARtH.css"])))=>i.map(i=>d[i]);
import{_ as K,a as z,o as l,c as d,b as o,t as h,j as f,w as g,n as q,g as P,e as B,l as G,x as Z,F as C,r as _,h as X,d as $,C as N,B as O,f as A,D as ee,i as te,T as se,K as ie,k as Y}from"./index-DFHtCH6M.js";import{p as Q}from"./Misc-D3fhnEf0.js";import{M as ne}from"./ModalComponent-B-ePo8ic.js";import{_ as oe}from"./ContentItem-BvthkZQ-.js";import{C as re,E as le,W as ae,p as de,r as ce}from"./WatchOnButton-Dm950qLy.js";import{V as ue,P as he,_ as me}from"./VideoItem-BNJ24tbL.js";import{L as pe}from"./LoadingIndicatorPage-D98bvYGK.js";import"./CreatePlaylistModal-D_amQld8.js";import"./ConfirmModal-DRMIgDMG.js";const fe=K(()=>import("./shaka-player.ui-BxG0Tsk8.js").then(t=>t.s),[]),ve=K(()=>import("./index-DFHtCH6M.js").then(t=>t.J),__vite__mapDeps([0,1])),ge={components:{ModalComponent:ne},props:{video:{type:Object,default:()=>({})},sponsors:{type:Object,default:()=>({})},selectedAutoPlay:Boolean,selectedAutoLoop:Boolean,isEmbed:Boolean},emits:["timeupdate","ended","navigateNext"],data(){return{lastUpdate:new Date().getTime(),initialSeekComplete:!1,destroying:!1,inSegment:!1,isHoveringTimebar:!1,showSpeedModal:!1,showCurrentSpeed:!1,hideCurrentSpeed:null,showCurrentVolume:!1,hideCurrentVolume:null,playbackSpeedInput:null,currentTime:0,seekbarPadding:2,error:0}},computed:{shouldAutoPlay:t=>t.getPreferenceBoolean("playerAutoPlay",!0)&&!t.isEmbed,preferredVideoCodecs:t=>{var e=[];const n=t.getPreferenceString("enabledCodecs","vp9,avc").split(",");return t.$refs.videoEl.canPlayType('video/mp4; codecs="av01.0.08M.08"')!==""&&n.includes("av1")&&e.push("av01"),t.$refs.videoEl.canPlayType('video/webm; codecs="vp9"')!==""&&n.includes("vp9")&&e.push("vp9"),t.$refs.videoEl.canPlayType('video/mp4; codecs="avc1.4d401f"')!==""&&n.includes("avc")&&e.push("avc1"),e}},mounted(){this.$shaka||(this.shakaPromise=fe.then(t=>t.default).then(t=>this.$shaka=t)),this.$hotkeys||(this.hotkeysPromise=ve.then(t=>t.default).then(t=>this.$hotkeys=t))},activated(){var t,e;this.destroying=!1,(e=(t=this.sponsors)==null?void 0:t.segments)==null||e.forEach(n=>n.skipped=!1),this.hotkeysPromise.then(()=>{var n=this;this.$hotkeys("f,m,j,k,l,c,space,up,down,left,right,ctrl+left,ctrl+right,home,end,0,1,2,3,4,5,6,7,8,9,shift+n,shift+s,shift+,,shift+.,alt+p,return,.,,",function(r,s){var a;const i=n.$refs.videoEl;switch(s.key){case"f":n.$ui.getControls().toggleFullScreen(),r.preventDefault();break;case"m":i.muted=!i.muted,r.preventDefault();break;case"j":i.currentTime=Math.max(i.currentTime-15,0),r.preventDefault();break;case"l":i.currentTime=i.currentTime+15,r.preventDefault();break;case"c":n.$player.setTextTrackVisibility(!n.$player.isTextTrackVisible()),r.preventDefault();break;case"k":case"space":i.paused?i.play():i.pause(),r.preventDefault();break;case"up":n.adjustPlaybackVolume(i.volume+.05),r.preventDefault();break;case"down":n.adjustPlaybackVolume(i.volume-.05),r.preventDefault();break;case"left":i.currentTime=Math.max(i.currentTime-5,0),r.preventDefault();break;case"right":i.currentTime=i.currentTime+5,r.preventDefault();break;case"ctrl+left":{i.currentTime=n.video.chapters.findLast(c=>c.start<i.currentTime).start,r.preventDefault();break}case"ctrl+right":{i.currentTime=((a=n.video.chapters.find(c=>c.start>i.currentTime))==null?void 0:a.start)||i.duration,r.preventDefault();break}case"home":i.currentTime=0,r.preventDefault();break;case"end":i.currentTime=i.duration,r.preventDefault();break;case"0":i.currentTime=0,r.preventDefault();break;case"1":i.currentTime=i.duration*.1,r.preventDefault();break;case"2":i.currentTime=i.duration*.2,r.preventDefault();break;case"3":i.currentTime=i.duration*.3,r.preventDefault();break;case"4":i.currentTime=i.duration*.4,r.preventDefault();break;case"5":i.currentTime=i.duration*.5,r.preventDefault();break;case"6":i.currentTime=i.duration*.6,r.preventDefault();break;case"7":i.currentTime=i.duration*.7,r.preventDefault();break;case"8":i.currentTime=i.duration*.8,r.preventDefault();break;case"9":i.currentTime=i.duration*.9,r.preventDefault();break;case"shift+n":n.$emit("navigateNext"),r.preventDefault();break;case"shift+s":n.showSpeedModal=!0;break;case"shift+,":n.adjustPlaybackSpeed(i.playbackRate-.25);break;case"shift+.":n.adjustPlaybackSpeed(i.playbackRate+.25);break;case"alt+p":document.pictureInPictureElement?document.exitPictureInPicture():i.requestPictureInPicture();break;case"return":n.skipSegment(i);break;case".":i.currentTime+=.04,r.preventDefault();break;case",":i.currentTime-=.04,r.preventDefault();break}})})},deactivated(){this.destroying=!0,this.destroy(!0)},unmounted(){this.destroying=!0,this.destroy(!0)},methods:{async loadVideo(){this.updateSponsors();const t=this,e=this.$refs.videoEl;e.setAttribute("poster",this.video.thumbnailUrl);const n=!this.$player;var r=[];r.push(...this.video.audioStreams),r.push(...this.video.videoStreams);const s=window.MediaSource!==void 0,i=null;var a,c;if(this.video.livestream)a=this.video.hls,c="application/x-mpegURL";else if(this.video.audioStreams.length>0&&!i&&s&&!this.getPreferenceBoolean("preferHls",!1)){if(this.video.dash){const m=new URL(this.video.dash);m.searchParams.set("rewrite",!1),a=m.toString()}else{const m=(await K(async()=>{const{generate_dash_file_from_formats:p}=await import("./DashUtils-Ddrh9JML.js");return{generate_dash_file_from_formats:p}},[])).generate_dash_file_from_formats(r,this.video.duration);a="data:application/dash+xml;charset=utf-8;base64,"+btoa(m)}c="application/dash+xml"}else this.video.hls?(a=this.video.hls,c="application/x-mpegURL"):(a=this.video.videoStreams.findLast(m=>m.codec==null).url,c="video/mp4");n?this.shakaPromise.then(async()=>{if(this.destroying)return;this.$shaka.polyfill.installAll();const m=new this.$shaka.Player;await m.attach(e);const p=new URL(t.video.proxyUrl);let v=p.pathname;v.lastIndexOf("/")===v.length-1&&(v=v.substring(0,v.length-1)),m.getNetworkingEngine().registerRequestFilter((L,M)=>{const U=M.uris[0];var y=new URL(U);const E=M.headers;(y.host.endsWith(".googlevideo.com")||y.host.endsWith(".lbryplayer.xyz")&&(t.getPreferenceBoolean("proxyLBRY",!1)||E.Range))&&(y.searchParams.set("host",y.host),y.protocol=p.protocol,y.host=p.host,y.pathname=v+y.pathname,M.uris[0]=y.toString()),y.pathname===v+"/videoplayback"&&E.Range&&(y.searchParams.set("range",E.Range.split("=")[1]),M.headers={},M.uris[0]=y.toString())}),m.configure("streaming.bufferingGoal",Math.max(this.getPreferenceNumber("bufferGoal",10),10)),m.configure("streaming.bufferBehind",300),this.setPlayerAttrs(m,e,a,c,this.$shaka)}):this.setPlayerAttrs(this.$player,e,a,c,this.$shaka),n&&(e.addEventListener("loadeddata",()=>{document.pictureInPictureElement&&e.requestPictureInPicture()}),e.addEventListener("timeupdate",()=>{const m=e.currentTime;if(this.$emit("timeupdate",m),this.updateProgressDatabase(m),this.sponsors&&this.sponsors.segments){const p=this.findCurrentSegment(m);this.inSegment=!!p,p!=null&&p.autoskip&&(!p.skipped||this.selectedAutoLoop)&&this.skipSegment(e,p)}}),e.addEventListener("volumechange",()=>{this.setPreference("volume",e.volume,!0)}),e.addEventListener("ratechange",m=>{const p=e.playbackRate;p>0&&!isNaN(e.duration)&&!isNaN(e.duration-m.timeStamp/1e3)&&this.setPreference("rate",p,!0)}),e.addEventListener("ended",()=>{this.$emit("ended")}))},findCurrentSegment(t){var e,n;return(n=(e=this.sponsors)==null?void 0:e.segments)==null?void 0:n.find(r=>t>=r.segment[0]&&t<r.segment[1])},onClickSkipSegment(){const t=this.$refs.videoEl;this.skipSegment(t)},skipSegment(t,e){const n=t.currentTime;e||(e=this.findCurrentSegment(n)),e&&(console.log("Skipped segment at "+n),t.currentTime=e.segment[1],e.skipped=!0)},async setPlayerAttrs(t,e,n,r,s){var j;const i="/watch?v="+this.video.id;if(!this.$ui){this.destroy();const T=class extends s.ui.Element{constructor(R,V){super(R,V),this.newTabButton_=document.createElement("button"),this.newTabButton_.classList.add("shaka-cast-button"),this.newTabButton_.classList.add("shaka-tooltip"),this.newTabButton_.ariaPressed="false",this.newTabIcon_=document.createElement("i"),this.newTabIcon_.classList.add("material-icons-round"),this.newTabIcon_.textContent="launch",this.newTabButton_.appendChild(this.newTabIcon_);const x=document.createElement("label");x.classList.add("shaka-overflow-button-label"),x.classList.add("shaka-overflow-menu-only"),this.newTabNameSpan_=document.createElement("span"),this.newTabNameSpan_.innerText="Open in new tab",x.appendChild(this.newTabNameSpan_),this.newTabButton_.appendChild(x),this.parent.appendChild(this.newTabButton_),this.eventManager.listen(this.newTabButton_,"click",()=>{this.video.pause(),window.open(i)})}};T.Factory=class{create(R,V){return new T(R,V)}},s.ui.OverflowMenu.registerElement("open_new_tab",new T.Factory),this.$ui=new s.ui.Overlay(t,this.$refs.container,e);const w=["quality","captions","picture_in_picture","playback_rate","airplay"];this.isEmbed&&w.push("open_new_tab");const S={overflowMenuButtons:w,seekBarColors:{base:"var(--player-base)",buffered:"var(--player-buffered)",played:"var(--player-played)"}};this.$ui.configure(S)}this.updateMarkers();const a=new Event("playerInit");window.dispatchEvent(a);const c=this.$ui.getControls().getPlayer();this.setupSeekbarPreview(),this.$player=c;const m=this.getPreferenceBoolean("listen",!1)&&!this.video.livestream,p=Math.min(Math.max(this.getPreferenceNumber("prefetchLimit",2),0),10);this.$player.configure({preferredVideoCodecs:this.preferredVideoCodecs,preferredAudioCodecs:["opus","mp4a"],manifest:{disableVideo:m},streaming:{segmentPrefetchLimit:p,retryParameters:{maxAttempts:1/0,baseDelay:250,backoffFactor:1.5}}});const v=this.getPreferenceNumber("quality",0),L=v>0&&(this.video.audioStreams.length>0||this.video.livestream)&&!m;L&&this.$player.configure("abr.enabled",!1);const M=(j=this.$route.query.t)!=null?j:this.$route.query.start;var U=0;M?(U=Q(M),this.initialSeekComplete=!0):window.db&&this.getPreferenceBoolean("watchHistory",!1)?await new Promise(T=>{var w=window.db.transaction("watch_history","readonly"),S=w.objectStore("watch_history"),R=S.get(this.video.id);R.onsuccess=function(V){var x=V.target.result;const D=x==null?void 0:x.currentTime;D&&D<x.duration*.9&&(U=D),T()},w.oncomplete=()=>{this.initialSeekComplete=!0}}):this.initialSeekComplete=!0,c.load(n,U,r).then(()=>{var W,u;if(!((u=(W=window.navigator)==null?void 0:W.vendor)==null?void 0:u.includes("Apple"))){const b=this.getPreferenceString("hl","en").substr(0,2);var w="en";for(var S in c.getAudioLanguages())if(S==b){w=S;return}c.selectAudioLanguage(w)}if(c.getAudioLanguages().length>1){const b=this.$ui.getConfiguration().overflowMenuButtons,k=[...b.slice(0,1),"language",...b.slice(1)];this.$ui.configure("overflowMenuButtons",k)}if(L){var V=Number.MAX_VALUE,x=null,D=0;const b=c.getVariantTracks().filter(k=>k.language==w||k.language=="und");v>=480&&b.forEach(k=>{const I=k.audioBandwidth;I>D&&(D=I)}),b.sort((k,I)=>k.bandwidth-I.bandwidth).forEach(k=>{if(k.audioBandwidth<D)return;const I=Math.abs(v-k.height);I<V&&(V=I,x=k)}),c.selectVariantTrack(x,!0)}this.video.subtitles.map(b=>{c.addTextTrackAsync(b.url,b.code,"subtitles",b.mimeType,null,b.name)}),e.volume=this.getPreferenceNumber("volume",1);const H=this.getPreferenceNumber("rate",1);e.playbackRate=H,e.defaultPlaybackRate=H;const J=this.getPreferenceBoolean("autoDisplayCaptions",!1);this.$player.setTextTrackVisibility(J);const F=this.getPreferenceString("subtitles","");if(F!==""){const b=this.$player.getTextTracks(),k=b.findIndex(I=>I.language==F);k!=-1&&(this.$player.setTextTrackVisibility(!0),this.$player.selectTextTrack(b[k]))}}).catch(T=>{console.error(T),this.error=T.code}),this.$route.query.fullscreen==="true"&&!this.$ui.getControls().isFullScreenEnabled()&&this.$ui.getControls().toggleFullScreen();const y=this.$refs.container.querySelector(".shaka-seek-bar"),E=["to right"];for(const T of this.video.chapters){const w=T.start/this.video.duration*100;w!==0&&(E.push("transparent ".concat(w,"%")),E.push("black ".concat(w,"%")),E.push("black calc(".concat(w,"% + 1px)")),E.push("transparent calc(".concat(w,"% + 1px)")))}y.style.background="linear-gradient(".concat(E.join(","),")"),y.addEventListener("mouseup",()=>{this.$refs.videoEl.focus()})},async updateProgressDatabase(t){if(!(new Date().getTime()-this.lastUpdate<500)&&(this.lastUpdate=new Date().getTime(),!(!this.initialSeekComplete||!this.video.id||!window.db))){var e=window.db.transaction("watch_history","readwrite"),n=e.objectStore("watch_history"),r=n.get(this.video.id);r.onsuccess=function(s){var i=s.target.result;i&&(i.currentTime=t,n.put(i))}}},seek(t){this.$refs.videoEl&&(this.$refs.videoEl.currentTime=t)},adjustPlaybackSpeed(t){const e=Math.min(4,Math.max(.25,t));this.$player.trickPlay(e),this.hideCurrentSpeed&&window.clearTimeout(this.hideCurrentSpeed),this.showCurrentSpeed=!1,this.showCurrentSpeed=!0,this.hideCurrentSpeed=window.setTimeout(()=>this.showCurrentSpeed=!1,1500)},adjustPlaybackVolume(t){const e=Math.min(1,Math.max(0,t));this.$refs.videoEl.volume=e,this.hideCurrentVolume&&window.clearTimeout(this.hideCurrentVolume),this.showCurrentVolume=!1,this.showCurrentVolume=!0,this.hideCurrentVolume=window.setTimeout(()=>this.showCurrentVolume=!1,1500)},setSpeedFromInput(){try{const t=Number(this.playbackSpeedInput);this.adjustPlaybackSpeed(t)}catch(t){alert(this.$t("actions.invalid_input"))}this.showSpeedModal=!1},updateMarkers(){var n,r;const t=this.$refs.container.querySelector(".shaka-ad-markers"),e=["to right"];(r=(n=this.sponsors)==null?void 0:n.segments)==null||r.forEach(s=>{const i=s.segment[0]/this.video.duration*100,a=s.segment[1]/this.video.duration*100;var c=["sponsor","selfpromo","interaction","poi_highlight","intro","outro","preview","filler","music_offtopic"].includes(s.category)?"var(--spon-seg-".concat(s.category,")"):"var(--spon-seg-default)";e.push("transparent ".concat(i,"%")),e.push("".concat(c," ").concat(i,"%")),e.push("".concat(c," ").concat(a,"%")),e.push("transparent ".concat(a,"%"))}),!(e.length<=1)&&t&&(t.style.background="linear-gradient(".concat(e.join(","),")"))},updateSponsors(){this.getPreferenceBoolean("showMarkers",!0)&&this.shakaPromise.then(()=>{this.updateMarkers()})},setupSeekbarPreview(){if(!this.video.previewFrames)return;let t=document.querySelector(".shaka-seek-bar");t.addEventListener("mousemove",e=>{this.isHoveringTimebar=!0;const n=e.offsetX/e.target.offsetWidth*this.video.duration;this.showSeekbarPreview(n*1e3)}),t.addEventListener("mouseout",()=>{this.isHoveringTimebar=!1,this.$refs.previewContainer.style.display="none"})},async showSeekbarPreview(t){const e=this.getFrame(t),n=await this.loadImage(e.url);if(!this.isHoveringTimebar)return;const r=document.querySelector(".shaka-seek-bar"),s=this.$refs.previewContainer,i=this.$refs.preview,a=i.getContext("2d"),c=e.positionX*e.frameWidth,m=e.positionY*e.frameHeight;i.width=e.frameWidth>100?e.frameWidth:e.frameWidth*2,i.height=e.frameWidth>100?e.frameHeight:e.frameHeight*2,a.drawImage(n,c,m,e.frameWidth,e.frameHeight,0,0,i.width,i.height);const v=t/this.video.duration/10-.5*i.width/r.clientWidth*100,L=(r.clientWidth-i.clientWidth)/r.clientWidth*100-this.seekbarPadding;this.currentTime=t/1e3,s.style.left="max(".concat(this.seekbarPadding,"%, min(").concat(v,"%, ").concat(L,"%))"),s.style.display="flex"},getFrame(t){let e=0;const n=this.video.previewFrames.at(-1);for(let r=0;r<n.urls.length;r++)for(let s=0;s<n.framesPerPageY;s++)for(let i=0;i<n.framesPerPageX;i++){const a=e+n.durationPerFrame;if(t>=e&&t<=a)return{url:n.urls[r],positionX:i,positionY:s,frameWidth:n.frameWidth,frameHeight:n.frameHeight};e=a}return null},loadImage(t){return new Promise(e=>{const n=new Image;n.onload=()=>e(n),n.src=t})},destroy(t){var e,n;this.$ui&&!document.pictureInPictureElement&&(this.$ui.destroy(),this.$ui=void 0,this.$player=void 0),this.$player&&(this.$player.destroy(),document.pictureInPictureElement||(this.$player=void 0)),t&&((e=this.$hotkeys)==null||e.unbind()),(n=this.$refs.container)==null||n.querySelectorAll("div").forEach(r=>r.remove())}}},ye=["autoplay","loop"],be={id:"preview-container",ref:"previewContainer",class:"absolute bottom-0 z-[2000] mb-[3.5%] hidden flex-col items-center"},_e={id:"preview",ref:"preview",class:"rounded-sm"},we={key:0,class:"mt-2 text-sm drop-shadow-[0_0_2px_white] -mb-2 .dark:drop-shadow-[0_0_2px_black]"},ke=["textContent"],xe=["aria-label"],Ce=o("i",{class:"material-icons-round"},"skip_next",-1),Se={key:1,class:"absolute top-8 rounded bg-black/80 p-2 text-lg backdrop-blur-sm"},Pe={key:2,class:"text-l absolute left-1/2 top-1/2 flex flex-col transform items-center gap-6 rounded-8 bg-white/80 px-8 py-4 -translate-x-1/2 -translate-y-1/2 .dark:bg-dark-700/80"},Te=o("i",{class:"i-fa6-solid:gauge-high h-25 w-25 p-5"},null,-1),Le=["textContent"],Ie={key:3,class:"text-l absolute left-1/2 top-1/2 flex flex-col transform items-center gap-6 rounded-8 bg-white/80 px-8 py-4 -translate-x-1/2 -translate-y-1/2 .dark:bg-dark-700/80"},Ee={key:0,class:"i-fa6-solid:volume-high h-25 w-25 p-5"},Ve={key:1,class:"i-fa6-solid:volume-xmark h-25 w-25 p-5"},$e=["textContent"],Me={class:"flex flex-col"},De=["placeholder"];function Ae(t,e,n,r,s,i){var m;const a=_("ModalComponent"),c=X("t");return l(),d(C,null,[o("div",{ref:"container","data-shaka-player-container":"",class:q(["relative max-h-screen w-full flex justify-center",{"player-container":!n.isEmbed}])},[o("video",{ref:"videoEl",class:"w-full","data-shaka-player":"",autoplay:i.shouldAutoPlay,loop:n.selectedAutoLoop},null,8,ye),o("span",be,[o("canvas",_e,null,512),n.video.chapters.length>1?(l(),d("span",we,h((m=n.video.chapters.findLast(p=>p.start<s.currentTime))==null?void 0:m.title),1)):f("",!0),o("span",{class:"mt-2 w-min rounded-xl bg-white px-2 pb-1 pt-1.5 text-sm .dark:bg-dark-700",textContent:h(t.timeFormat(s.currentTime))},null,8,ke)],512),s.inSegment?(l(),d("button",{key:0,class:"skip-segment-button",type:"button","aria-label":t.$t("actions.skip_segment"),"aria-pressed":"false",onClick:e[0]||(e[0]=(...p)=>i.onClickSkipSegment&&i.onClickSkipSegment(...p))},[g(o("span",null,null,512),[[c,"actions.skip_segment"]]),Ce],8,xe)):f("",!0),s.error>0?g((l(),d("span",Se,null,512)),[[c,{path:"player.failed",args:[s.error]}]]):f("",!0),s.showCurrentSpeed?(l(),d("div",Pe,[Te,o("span",{textContent:h(t.$refs.videoEl.playbackRate)},null,8,Le)])):f("",!0),s.showCurrentVolume?(l(),d("div",Ie,[t.$refs.videoEl.volume>0?(l(),d("i",Ee)):(l(),d("i",Ve)),o("span",{textContent:h(Math.round(t.$refs.videoEl.volume*100)/100)},null,8,$e)])):f("",!0)],2),s.showSpeedModal?(l(),P(a,{key:0,onClose:e[4]||(e[4]=p=>s.showSpeedModal=!1)},{default:B(()=>[g(o("h2",null,null,512),[[c,"actions.playback_speed"]]),o("div",Me,[g(o("input",{"onUpdate:modelValue":e[1]||(e[1]=p=>s.playbackSpeedInput=p),class:"input my-3",type:"text",placeholder:t.$t("actions.playback_speed"),onKeyup:e[2]||(e[2]=Z(p=>i.setSpeedFromInput(),["enter"]))},null,40,De),[[G,s.playbackSpeedInput]]),g(o("button",{class:"btn ml-auto w-min",onClick:e[3]||(e[3]=p=>i.setSpeedFromInput())},null,512),[[c,"actions.okay"]])])]),_:1})):f("",!0)],64)}const Re=z(ge,[["render",Ae]]),Be={components:{CollapsableText:re},props:{comment:{type:Object,default:()=>({})},uploader:{type:String,default:null},uploaderAvatarUrl:{type:String,default:null},videoId:{type:String,default:null}},data(){return{loadingReplies:!1,showingReplies:!1,replies:[],nextpage:null}},methods:{async loadReplies(){if(console.log(this.uploaderAvatarUrl),!this.showingReplies&&this.loadingReplies){this.showingReplies=!0;return}this.loadingReplies=!0,this.showingReplies=!0,this.fetchJson(this.apiUrl()+"/nextpage/comments/"+this.videoId,{nextpage:this.nextpage||this.comment.repliesPage}).then(t=>{this.replies=this.replies.concat(t.comments),this.nextpage=t.nextpage})},async hideReplies(){this.showingReplies=!1}}},Ue={class:"comment mt-1.5 flex"},Ne=["src"],qe={class:"comment-content pl-2"},He={class:"comment-header"},Fe={key:0,class:"comment-pinned"},We=o("i",{class:"i-fa6-solid:thumbtack"},null,-1),Oe={class:"ml-1.5"},ze={class:"comment-author"},je={key:0,class:"i-fa6-solid:check ml-1.5"},Je=["textContent"],Xe={class:"comment-footer my-1 flex items-center gap-3"},Ye=o("div",{class:"i-fa6-solid:thumbs-up"},null,-1),Ke=["textContent"],Qe=["title"],Ge=["src","title"],Ze=["textContent"],et=o("i",{class:"i-fa6-solid:level-down-alt ml-1.5"},null,-1),tt=o("i",{class:"i-fa6-solid:level-up-alt ml-1.5"},null,-1),st={key:2,class:"replies"},it=o("i",{class:"i-fa6-solid:level-down-alt ml-1.5"},null,-1);function nt(t,e,n,r,s,i){const a=_("router-link"),c=_("CollapsableText"),m=_("CommentItem",!0),p=X("t");return l(),d("div",Ue,[o("img",{loading:"lazy",src:n.comment.thumbnail,class:"comment-avatar h-12 w-12 rounded-full",height:"48",width:"48",alt:"Avatar"},null,8,Ne),o("div",qe,[o("div",He,[n.comment.pinned?(l(),d("div",Fe,[We,g(o("span",Oe,null,512),[[p,{path:"comment.pinned_by",args:{author:n.uploader}}]])])):f("",!0),o("div",ze,[$(a,{class:"link font-bold",to:n.comment.commentorUrl},{default:B(()=>[N(h(n.comment.author),1)]),_:1},8,["to"]),n.comment.verified?(l(),d("i",je)):f("",!0)]),o("div",{class:"comment-meta mb-1.5 text-sm",textContent:h(n.comment.commentedTime)},null,8,Je)]),$(c,{text:n.comment.commentText,"visible-limit":500},null,8,["text"]),o("div",Xe,[Ye,o("span",{textContent:h(t.numberFormat(n.comment.likeCount))},null,8,Ke),n.comment.hearted?(l(),d("i",{key:0,class:"i-fa6-solid:heart",title:t.$t("actions.creator_liked")},null,8,Qe)):f("",!0),n.comment.creatorReplied?(l(),d("img",{key:1,src:n.uploaderAvatarUrl,class:"h-5 w-5 rounded-full",title:t.$t("actions.creator_replied")},null,8,Ge)):f("",!0)]),n.comment.repliesPage&&(!s.loadingReplies||!s.showingReplies)?(l(),d("div",{key:0,class:"cursor-pointer",onClick:e[0]||(e[0]=(...v)=>i.loadReplies&&i.loadReplies(...v))},[o("a",{textContent:h("".concat(t.$t("actions.reply_count",n.comment.replyCount)))},null,8,Ze),et])):f("",!0),s.showingReplies?(l(),d("div",{key:1,class:"cursor-pointer",onClick:e[1]||(e[1]=(...v)=>i.hideReplies&&i.hideReplies(...v))},[g(o("a",null,null,512),[[p,"actions.hide_replies"]]),tt])):f("",!0),s.replies?g((l(),d("div",st,[(l(!0),d(C,null,A(s.replies,v=>(l(),d("div",{key:v.commentId,class:"w-full"},[$(m,{comment:v,uploader:n.uploader,"video-id":n.videoId},null,8,["comment","uploader","video-id"])]))),128)),s.nextpage?(l(),d("div",{key:0,class:"cursor-pointer",onClick:e[2]||(e[2]=(...v)=>i.loadReplies&&i.loadReplies(...v))},[g(o("a",null,null,512),[[p,"actions.load_more_replies"]]),it])):f("",!0)],512)),[[O,s.showingReplies]]):f("",!0)])])}const ot=z(Be,[["render",nt]]),rt={key:0,class:"max-h-75vh max-w-35vw min-h-64 flex-col overflow-y-scroll lt-lg:hidden"},lt={class:"mb-2 bg-gray-500/50 p-2","aria-label":"chapters",title:"chapters"},at=["onClick"],dt={class:"flex"},ct=["textContent"],ut=["src","alt"],ht={class:"m-2 flex flex-col"},mt=["title","textContent"],pt=["textContent"],ft={key:1,class:"max-h-64 flex flex-col overflow-y-scroll"},vt={class:"mb-2 bg-gray-500/50 p-2","aria-label":"chapters",title:"chapters"},gt=["onClick"],yt={class:"flex"},bt=["textContent"],_t=["src","alt"],wt={class:"m-2 flex flex-col"},kt=["title","textContent"],xt=["textContent"],Ct={key:2,class:"flex overflow-x-auto"},St=["onClick"],Pt=["src","alt"],Tt={class:"m-1 flex"},Lt=["title","textContent"],It=["textContent"],Et={__name:"ChaptersBar",props:{chapters:{type:Object,default:()=>null},mobileLayout:{type:Boolean,default:()=>!0},playerPosition:{type:Number,default:()=>0}},emits:["seek"],setup(t){const e=t,n=r=>{var s,i;return e.playerPosition>=e.chapters[r].start&&e.playerPosition<((i=(s=e.chapters[r+1])==null?void 0:s.start)!=null?i:1/0)};return(r,s)=>(l(),d(C,null,[t.mobileLayout?f("",!0):(l(),d("div",rt,[o("h2",lt,h(r.$t("video.chapters"))+" ("+h(t.chapters.length)+") ",1),(l(!0),d(C,null,A(t.chapters,(i,a)=>(l(),d("div",{key:i.start,class:q(["chapter-vertical",{"bg-red-500/50":n(a)}]),onClick:c=>r.$emit("seek",i.start)},[o("div",dt,[o("span",{class:"mr-2 mt-5 text-current",textContent:h(a+1)},null,8,ct),o("img",{class:"shrink-0",src:i.image,alt:i.title},null,8,ut),o("div",ht,[o("span",{class:"text-sm",title:i.title,textContent:h(i.title)},null,8,mt),o("span",{class:"text-sm text-blue-500 font-bold",textContent:h(r.timeFormat(i.start))},null,8,pt)])])],10,at))),128))])),t.mobileLayout&&r.getPreferenceString("mobileChapterLayout")=="Vertical"?(l(),d("div",ft,[o("h2",vt,h(r.$t("video.chapters"))+" ("+h(t.chapters.length)+") ",1),(l(!0),d(C,null,A(t.chapters,(i,a)=>(l(),d("div",{key:i.start,class:q(["chapter-vertical",{"bg-red-500/50":n(a)}]),onClick:c=>r.$emit("seek",i.start)},[o("div",yt,[o("span",{class:"mr-2 mt-5 text-current",textContent:h(a+1)},null,8,bt),o("img",{class:"shrink-0",src:i.image,alt:i.title},null,8,_t),o("div",wt,[o("span",{class:"text-sm",title:i.title,textContent:h(i.title)},null,8,kt),o("span",{class:"text-sm text-blue-500 font-bold",textContent:h(r.timeFormat(i.start))},null,8,xt)])])],10,gt))),128))])):f("",!0),r.getPreferenceString("mobileChapterLayout")=="Horizontal"&&t.mobileLayout?(l(),d("div",Ct,[(l(!0),d(C,null,A(t.chapters,(i,a)=>(l(),d("div",{key:i.start,class:q(["chapter",{"bg-red-500/50":n(a)}]),onClick:c=>r.$emit("seek",i.start)},[o("img",{src:i.image,alt:i.title},null,8,Pt),o("div",Tt,[o("span",{class:"text-truncate text-sm",title:i.title,textContent:h(i.title)},null,8,Lt),o("span",{class:"px-1 text-sm text-blue-500 font-bold",textContent:h(r.timeFormat(i.start))},null,8,It)])],10,St))),128))])):f("",!0)],64))}},Vt={components:{VideoItem:ue},props:{playlist:{type:Object,required:!0},playlistId:{type:String,required:!0},selectedIndex:{type:Number,required:!0},preferListen:{type:Boolean,default:!1}},watch:{playlist:{handler(){this.selectedIndex-1<this.playlist.relatedStreams.length&&ee(()=>{this.updateScroll()})},deep:!0}},mounted(){this.updateScroll(),this.updateWatched(this.playlist.relatedStreams)},methods:{updateScroll(){const t=Array.from(this.$refs.scrollable.children).filter(n=>n.matches("div"));this.selectedIndex-1<t.length&&(this.$refs.scrollable.scrollTop=t[this.selectedIndex-1].offsetTop-this.$refs.scrollable.offsetTop)}}},$t={ref:"scrollable",class:"h-screen-sm overflow-x-scroll"};function Mt(t,e,n,r,s,i){const a=_("VideoItem");return l(),d("div",$t,[(l(!0),d(C,null,A(n.playlist.relatedStreams,(c,m)=>(l(),P(a,{key:c.url,item:c,index:m,"playlist-id":n.playlistId,"prefer-listen":n.preferListen,height:"94",width:"168"},null,8,["item","index","playlist-id","prefer-listen"]))),128))],512)}const Dt=z(Vt,[["render",Mt]]),At={emits:["dismissed"],methods:{dismiss(){this.$emit("dismissed")}}},Rt={class:"toast"};function Bt(t,e,n,r,s,i){const a=X("t");return l(),d("div",Rt,[te(t.$slots,"default"),g(o("button",{onClick:e[0]||(e[0]=(...c)=>i.dismiss&&i.dismiss(...c))},null,512),[[a,"actions.dismiss"]])])}const Ut=z(At,[["render",Bt]]),Nt={name:"App",components:{VideoPlayer:Re,ContentItem:oe,ErrorHandler:le,CommentItem:ot,ChaptersBar:Et,PlaylistAddModal:he,ShareModal:me,PlaylistVideos:Dt,WatchOnButton:ae,LoadingIndicatorPage:pe,ToastComponent:Ut},data(){const t=window.matchMedia("(max-width: 640px)");return{video:null,playlistId:null,playlist:null,index:null,sponsors:null,selectedAutoLoop:!1,selectedAutoPlay:null,showComments:!0,showDesc:!1,showRecs:!0,showChapters:!0,comments:null,subscribed:!1,channelId:null,active:!0,smallViewQuery:t,smallView:t.matches,showModal:!1,showShareModal:!1,isMobile:!0,currentTime:0,shouldShowToast:!1,timeoutCounter:null,counter:0}},computed:{isListening(t){return t.getPreferenceBoolean("listen",!1)},toggleListenUrl(t){const e=new URL(window.location.href);return e.searchParams.set("listen",t.isListening?"0":"1"),e.searchParams.set("t",Math.floor(this.currentTime)),e.pathname+e.search},isEmbed(t){return String(t.$route.path).indexOf("/embed/")==0},uploadDate(t){return new Date(t.video.uploadDate).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric"})},defaultCounter(t){return t.getPreferenceNumber("autoPlayNextCountdown",5)},purifiedDescription(){return de(this.video.description)},youtubeVideoHref(){let t="https://youtu.be/".concat(this.getVideoId(),"?t=").concat(Math.round(this.currentTime));return this.playlistId&&(t+="&list=".concat(this.playlistId)),t}},mounted(){window.innerWidth>=1024&&(this.isMobile=!1),window.addEventListener("resize",()=>{window.innerWidth>=1024?this.isMobile=!1:this.isMobile=!0}),this.getVideoData().then(()=>{(async()=>{const t=this.getVideoId(),e=this;if(window.db&&this.getPreferenceBoolean("watchHistory",!1)&&!this.video.error){var n=window.db.transaction("watch_history","readwrite"),r=n.objectStore("watch_history"),s=r.get(t);s.onsuccess=function(i){var a=i.target.result;a?a.watchedAt=Date.now():a={videoId:t,title:e.video.title,duration:e.video.duration,thumbnail:e.video.thumbnailUrl,uploaderUrl:e.video.uploaderUrl,uploaderName:e.video.uploader,watchedAt:Date.now()},r.put(a)}}})(),this.active&&this.$refs.videoPlayer.loadVideo()}),this.playlistId=this.$route.query.list,this.index=Number(this.$route.query.index),this.getPlaylistData(),this.getSponsors(),!this.isEmbed&&this.showComments&&this.getComments(),this.isEmbed&&(document.querySelector("html").style.overflow="hidden"),window.addEventListener("click",this.handleClick),window.addEventListener("resize",()=>{this.smallView=this.smallViewQuery.matches})},activated(){var t;this.active=!0,this.selectedAutoPlay=this.getPreferenceBoolean("autoplay",!1),this.showComments=!this.getPreferenceBoolean("minimizeComments",!1),this.showDesc=!this.getPreferenceBoolean("minimizeDescription",!0),this.showRecs=!this.getPreferenceBoolean("minimizeRecommendations",!1),this.showChapters=!this.getPreferenceBoolean("minimizeChapters",!1),(t=this.video)!=null&&t.duration&&(document.title=this.video.title+" - Piped",this.$refs.videoPlayer.loadVideo()),window.addEventListener("scroll",this.handleScroll)},deactivated(){this.active=!1,window.removeEventListener("scroll",this.handleScroll),this.dismiss()},unmounted(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("click",this.handleClick),this.dismiss()},methods:{fetchVideo(){return this.fetchJson(this.apiUrl()+"/streams/"+this.getVideoId())},async fetchSponsors(){var s,i;var t=this.getPreferenceString("selectedSkip","sponsor,interaction,selfpromo,music_offtopic").split(",");const e=this.getPreferenceJSON("skipOptions");e!==void 0&&(t=Object.keys(e).filter(a=>e[a]!==void 0&&e[a]!=="no"));const n=await this.fetchJson(this.apiUrl()+"/sponsors/"+this.getVideoId(),{category:JSON.stringify(t)});(s=n==null?void 0:n.segments)==null||s.forEach(a=>{const c=e==null?void 0:e[a.category];a.autoskip=c===void 0||c==="auto"});const r=Math.max(this.getPreferenceNumber("minSegmentLength",0),0);return n.segments=(i=n.segments)==null?void 0:i.filter(a=>a.segment[1]-a.segment[0]>=r),n},toggleComments(){this.showComments=!this.showComments,this.showComments&&this.comments===null&&this.fetchComments()},fetchComments(){return this.fetchJson(this.apiUrl()+"/comments/"+this.getVideoId())},onChange(){this.setPreference("autoplay",this.selectedAutoPlay,!0)},async getVideoData(){await this.fetchVideo().then(t=>{this.video=t,this.video.id=this.getVideoId()}).then(()=>{if(!this.video.error){document.title=this.video.title+" - Piped",this.channelId=this.video.uploaderUrl.split("/")[2],this.isEmbed||this.fetchSubscribedStatus();const e=new DOMParser().parseFromString(this.video.description,"text/html");e.querySelectorAll("a").forEach(n=>{n.innerText.match(/(?:[\d]{1,2}:)?(?:[\d]{1,2}):(?:[\d]{1,2})/)||(n.outerHTML=n.getAttribute("href"))}),e.querySelectorAll("br").forEach(n=>n.outerHTML="\n"),this.video.description=ce(e.querySelector("body").innerHTML),this.updateWatched(this.video.relatedStreams),this.fetchDeArrowContent(this.video.relatedStreams)}})},async getPlaylistData(){this.playlistId&&(this.playlist=await this.getPlaylist(this.playlistId),await this.fetchPlaylistPages().then(()=>{if(!(this.index>=0)){for(let t=0;t<this.playlist.relatedStreams.length;t++)if(this.playlist.relatedStreams[t].url.substr(-11)==this.getVideoId()){this.index=t+1,this.$router.replace({query:{...this.$route.query,index:this.index}});break}}}),await this.fetchPlaylistPages())},async fetchPlaylistPages(){this.playlist.nextpage&&(await this.fetchJson(this.apiUrl()+"/nextpage/playlists/"+this.playlistId,{nextpage:this.playlist.nextpage}).then(t=>{this.playlist.relatedStreams.push(...t.relatedStreams),this.playlist.nextpage=t.nextpage,this.fetchDeArrowContent(t.relatedStreams)}),await this.fetchPlaylistPages())},async getSponsors(){this.getPreferenceBoolean("sponsorblock",!0)&&this.fetchSponsors().then(t=>this.sponsors=t)},async getComments(){this.comments=await this.fetchComments()},async fetchSubscribedStatus(){this.channelId&&(this.subscribed=await this.fetchSubscriptionStatus(this.channelId))},subscribeHandler(){this.toggleSubscriptionState(this.channelId,this.subscribed).then(t=>{t&&(this.subscribed=!this.subscribed)})},handleClick(t){if(!t||!t.target||!t.target.matches("a[href]"))return;const e=t.target;e.getAttribute("href")&&this.handleTimestampLinks(e)&&t.preventDefault()},handleTimestampLinks(t){try{const e=new URL(t.getAttribute("href"),document.baseURI);if(e.searchParams.size>2||e.searchParams.get("v")!==this.getVideoId()||!e.searchParams.has("t"))return!1;const n=Q(e.searchParams.get("t"));return n&&this.navigate(n),!0}catch(e){console.error(e)}return!1},handleScroll(){var t;this.loading||!this.comments||!this.comments.nextpage||window.innerHeight+window.scrollY>=((t=this.$refs.comments)==null?void 0:t.offsetHeight)-window.innerHeight&&(this.loading=!0,this.fetchJson(this.apiUrl()+"/nextpage/comments/"+this.getVideoId(),{nextpage:this.comments.nextpage}).then(e=>{this.comments.nextpage=e.nextpage,this.loading=!1,this.comments.comments=this.comments.comments.concat(e.comments)}))},getVideoId(){var t;if(this.$route.query.video_ids){const e=this.$route.query.video_ids.split(",");return this.index=Number((t=this.$route.query.index)!=null?t:0),e[this.index]}return this.$route.query.v||this.$route.params.v},navigate(t){this.$refs.videoPlayer.seek(t)},onTimeUpdate(t){this.currentTime=t},onVideoEnded(){var t,e;!this.selectedAutoLoop&&this.selectedAutoPlay&&(((e=(t=this.playlist)==null?void 0:t.relatedStreams)==null?void 0:e.length)>0||this.video.relatedStreams.length>0)&&this.showToast()},showToast(){if(this.counter=this.defaultCounter,this.counter<1){this.navigateNext();return}this.timeoutCounter&&clearInterval(this.timeoutCounter),this.timeoutCounter=setInterval(()=>{this.counter--,this.counter===0&&(this.dismiss(),this.navigateNext())},1e3),this.shouldShowToast=!0},dismiss(){clearInterval(this.timeoutCounter),this.shouldShowToast=!1},navigateNext(){var a,c,m,p,v,L;const t=this.$route.query,e=(c=(a=this.$route.query.video_ids)==null?void 0:a.split(","))!=null?c:[];let n;this.playlist?n=(L=(v=(p=(m=this.playlist)==null?void 0:m.relatedStreams)==null?void 0:p[this.index])==null?void 0:v.url)!=null?L:this.video.relatedStreams[0].url:e.length>this.index+1?n="".concat(this.$route.path,"?index=").concat(this.index+1):n=this.video.relatedStreams[0].url;const r=new URLSearchParams;for(var s in t)switch(s){case"v":case"t":break;case"index":this.playlist&&this.index<this.playlist.relatedStreams.length&&r.set("index",this.index+1);break;case"list":this.index<this.playlist.relatedStreams.length&&r.set("list",t.list);break;default:r.set(s,t[s]);break}r.set("fullscreen",this.$refs.videoPlayer.$ui.getControls().isFullScreenEnabled());const i=r.toString();i.length>0&&(n+="&"+i),this.$router.push(n)},downloadCurrentFrame(){const t=document.querySelector("video"),e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height);let r=document.createElement("a");const s=Math.round(t.currentTime*1e3)/1e3;r.download="".concat(this.video.title,"_").concat(s,"s.png"),r.href=e.toDataURL(),r.click()}}},qt={key:0,class:"absolute left-0 top-0 z-50 h-full w-full bg-black"},Ht=["textContent"],Ft={class:"mb-3 mt-3 flex flex-wrap"},Wt={class:"flex flex-auto gap-2"},Ot=o("span",null," | ",-1),zt=["textContent"],jt={class:"flex gap-2"},Jt={class:"flex items-center"},Xt=o("div",{class:"i-fa6-solid:thumbs-up"},null,-1),Yt=["textContent"],Kt={class:"flex items-center"},Qt=o("div",{class:"i-fa6-solid:thumbs-down"},null,-1),Gt=["textContent"],Zt={key:1},es={class:"flex flex-wrap gap-1"},ts={class:"flex items-center"},ss=["src"],is={key:1,class:"i-fa6-solid:check ml-1"},ns={class:"ml-auto flex flex-wrap gap-1"},os=o("i",{class:"i-fa6-solid:download"},null,-1),rs=o("i",{class:"i-fa6-solid:circle-plus ml-1"},null,-1),ls=["textContent"],as={class:"flex flex-wrap gap-1"},ds=["href"],cs=o("i",{class:"i-fa6-solid:rss mx-1.5"},null,-1),us=[cs],hs=o("i",{class:"i-fa6-solid:share mx-1.5"},null,-1),ms=o("hr",{class:"mb-2"},null,-1),ps=["href"],fs=o("br",null,null,-1),vs={class:"btn ml-2"},gs={class:"ml-2",for:"showChapters"},ys=["innerHTML"],bs=o("br",null,null,-1),_s=["textContent"],ws=["textContent"],ks=["textContent"],xs=["textContent"],Cs={key:2,class:"mt-2 flex flex-wrap gap-2"},Ss=o("hr",null,null,-1),Ps={for:"chkAutoLoop"},Ts=["textContent"],Ls=o("br",null,null,-1),Is={for:"chkAutoPlay"},Es=["textContent"],Vs=o("hr",null,null,-1),$s={class:"grid grid-cols-1 sm:grid-cols-4 xl:grid-cols-5"},Ms={class:"sm:col-span-3 xl:col-span-4"},Ds=["textContent"],As={key:0,class:"sm:col-span-3 xl:col-span-4"},Rs={key:1,class:"sm:col-span-3 xl:col-span-4"},Bs={class:"mt-8 text-center"},Us={key:2,class:"sm:col-span-3 xl:col-span-4"},Ns={class:"mt-8 text-center"},qs={key:3,ref:"comments",class:"sm:col-span-3 xl:col-span-4"},Hs={key:4,class:"order-first sm:order-last"},Fs=o("hr",{class:"sm:hidden"},null,-1);function Ws(t,e,n,r,s,i){const a=_("VideoPlayer"),c=_("ErrorHandler"),m=_("i18n-t"),p=_("ToastComponent"),v=_("ChaptersBar"),L=_("router-link"),M=_("PlaylistAddModal"),U=_("ShareModal"),y=_("WatchOnButton"),E=_("CommentItem"),j=_("PlaylistVideos"),T=_("ContentItem"),w=_("LoadingIndicatorPage"),S=X("t");return l(),d(C,null,[s.video&&i.isEmbed?(l(),d("div",qt,[$(a,{ref:"videoPlayer",video:s.video,sponsors:s.sponsors,"selected-auto-play":!1,"selected-auto-loop":s.selectedAutoLoop,"is-embed":i.isEmbed},null,8,["video","sponsors","selected-auto-loop","is-embed"])])):f("",!0),$(w,{"show-content":s.video&&!i.isEmbed,class:"w-full"},{default:B(()=>{var R,V,x,D,H,J,F,W;return[s.video&&s.video.error?(l(),P(c,{key:0,message:s.video.message,error:s.video.error},null,8,["message","error"])):f("",!0),$(se,null,{default:B(()=>[s.shouldShowToast?(l(),P(p,{key:0,onDismissed:i.dismiss},{default:B(()=>[$(m,{keypath:"info.next_video_countdown"},{default:B(()=>[N(h(s.counter),1)]),_:1})]),_:1},8,["onDismissed"])):f("",!0)]),_:1}),g(o("div",null,[o("div",{class:q(s.isMobile?"flex-col":"flex")},[(l(),P(ie,null,[$(a,{ref:"videoPlayer",video:s.video,sponsors:s.sponsors,"selected-auto-play":s.selectedAutoPlay,"selected-auto-loop":s.selectedAutoLoop,onTimeupdate:i.onTimeUpdate,onEnded:i.onVideoEnded,onNavigateNext:i.navigateNext},null,8,["video","sponsors","selected-auto-play","selected-auto-loop","onTimeupdate","onEnded","onNavigateNext"])],1024)),((V=(R=s.video)==null?void 0:R.chapters)==null?void 0:V.length)>0&&s.showChapters?(l(),P(v,{key:0,"mobile-layout":s.isMobile,chapters:s.video.chapters,"player-position":s.currentTime,onSeek:i.navigate},null,8,["mobile-layout","chapters","player-position","onSeek"])):f("",!0)],2),o("div",{class:"mt-2 break-words text-2xl font-bold",textContent:h(s.video.title)},null,8,Ht),o("div",Ft,[o("div",Wt,[g(o("span",null,null,512),[[S,{path:"video.views",args:{views:t.addCommas(s.video.views)}}]]),Ot,o("span",{textContent:h(i.uploadDate)},null,8,zt)]),o("div",jt,[s.video.likes>=0?(l(),d(C,{key:0},[o("div",Jt,[Xt,o("strong",{class:"ml-1",textContent:h(t.addCommas(s.video.likes))},null,8,Yt)]),o("div",Kt,[Qt,o("strong",{class:"ml-1",textContent:h(s.video.dislikes>=0?t.addCommas(s.video.dislikes):"?")},null,8,Gt)])],64)):f("",!0),s.video.likes<0?(l(),d("div",Zt,[g(o("strong",null,null,512),[[S,"video.ratings_disabled"]])])):f("",!0)])]),o("div",es,[o("div",ts,[o("img",{loading:"lazy",height:"48",width:"48",src:s.video.uploaderAvatar,alt:"",class:"rounded-full"},null,8,ss),s.video.uploaderUrl?(l(),P(L,{key:0,class:"link ml-1.5",to:s.video.uploaderUrl},{default:B(()=>[N(h(s.video.uploader),1)]),_:1},8,["to"])):f("",!0),s.video.uploaderVerified?(l(),d("i",is)):f("",!0)]),s.showModal?(l(),P(M,{key:0,"video-id":i.getVideoId(),"video-info":s.video,onClose:e[0]||(e[0]=u=>s.showModal=!s.showModal)},null,8,["video-id","video-info"])):f("",!0),s.showShareModal?(l(),P(U,{key:1,"video-id":i.getVideoId(),"current-time":s.currentTime,"playlist-id":s.playlistId,"playlist-index":s.index,onClose:e[1]||(e[1]=u=>s.showShareModal=!s.showShareModal)},null,8,["video-id","current-time","playlist-id","playlist-index"])):f("",!0),o("div",ns,[o("button",{class:"btn flex items-center gap-1 <md:hidden",onClick:e[2]||(e[2]=(...u)=>i.downloadCurrentFrame&&i.downloadCurrentFrame(...u))},[N(h(t.$t("actions.download_frame")),1),os]),o("button",{class:"btn flex items-center",onClick:e[3]||(e[3]=u=>s.showModal=!s.showModal)},[N(h(t.$t("actions.add_to_playlist")),1),rs]),o("button",{class:"btn",onClick:e[4]||(e[4]=(...u)=>i.subscribeHandler&&i.subscribeHandler(...u)),textContent:h(t.$t("actions."+(s.subscribed?"unsubscribe":"subscribe"))+" - "+t.numberFormat(s.video.uploaderSubscriberCount))},null,8,ls),o("div",as,[s.video.uploaderUrl?(l(),d("a",{key:0,"aria-label":"RSS feed",title:"RSS feed",role:"button",href:"".concat(t.apiUrl(),"/feed/unauthenticated/rss?channels=").concat(s.video.uploaderUrl.split("/")[2]),target:"_blank",class:"btn flex items-center"},us,8,ds)):f("",!0),o("button",{class:"btn flex items-center",onClick:e[5]||(e[5]=u=>s.showShareModal=!s.showShareModal)},[$(m,{class:"lt-lg:hidden",keypath:"actions.share",tag:"strong"}),hs]),$(y,{link:i.youtubeVideoHref},null,8,["link"]),s.video.lbryId?(l(),P(y,{key:1,link:"https://odysee.com/".concat(s.video.lbryId),platform:"Odysee"},null,8,["link"])):f("",!0),$(L,{to:i.toggleListenUrl,"aria-label":(i.isListening?"Watch ":"Listen to ")+s.video.title,title:(i.isListening?"Watch ":"Listen to ")+s.video.title,class:"btn flex items-center"},{default:B(()=>[o("i",{class:q([i.isListening?"i-fa6-solid:tv":"i-fa6-solid:headphones","mx-1.5"])},null,2)]),_:1},8,["to","aria-label","title"])])])]),ms,(l(!0),d(C,null,A((D=(x=s.video)==null?void 0:x.metaInfo)!=null?D:[],u=>{var b;return l(),d("div",{key:u.title,class:"btn my-3 flex flex-wrap cursor-default gap-2 px-4 py-2"},[o("span",null,h((b=u.description)!=null?b:u.title),1),(l(!0),d(C,null,A(u.urls,(k,I)=>(l(),d("a",{key:I,href:k,class:"underline"},h(u.urlTexts[I]),9,ps))),128)),fs])}),128)),g(o("button",{class:"btn mb-2",onClick:e[6]||(e[6]=u=>s.showDesc=!s.showDesc)},null,512),[[S,"actions.".concat(s.showDesc?"minimize_description":"show_description")]]),g(o("span",vs,[g(o("input",{id:"showChapters","onUpdate:modelValue":e[7]||(e[7]=u=>s.showChapters=u),type:"checkbox"},null,512),[[Y,s.showChapters]]),g(o("label",gs,null,512),[[S,"actions.show_chapters"]])],512),[[O,((J=(H=s.video)==null?void 0:H.chapters)==null?void 0:J.length)>0]]),s.showDesc?(l(),d(C,{key:0},[o("div",{class:"description break-words",innerHTML:i.purifiedDescription},null,8,ys),bs,s.sponsors&&s.sponsors.segments?(l(),d("div",{key:0,textContent:h("".concat(t.$t("video.sponsor_segments"),": ").concat(s.sponsors.segments.length))},null,8,_s)):f("",!0),s.video.category?(l(),d("div",{key:1,textContent:h("".concat(t.$t("video.category"),": ").concat(s.video.category))},null,8,ws)):f("",!0),o("div",{textContent:h("".concat(t.$t("video.license"),": ").concat(s.video.license))},null,8,ks),o("div",{class:"capitalize",textContent:h("".concat(t.$t("video.visibility"),": ").concat(s.video.visibility))},null,8,xs),s.video.tags?(l(),d("div",Cs,[(l(!0),d(C,null,A(s.video.tags,u=>(l(),P(L,{key:u,class:"btn line-clamp-1 rounded-s px-2 py-1",to:"/results?search_query=".concat(encodeURIComponent(u))},{default:B(()=>[N(h(u),1)]),_:2},1032,["to"]))),128))])):f("",!0)],64)):f("",!0)],512),[[O,!s.video.error]]),Ss,o("label",Ps,[o("strong",{textContent:h("".concat(t.$t("actions.loop_this_video"),":"))},null,8,Ts)]),g(o("input",{id:"chkAutoLoop","onUpdate:modelValue":e[8]||(e[8]=u=>s.selectedAutoLoop=u),class:"ml-1.5",type:"checkbox",onChange:e[9]||(e[9]=u=>i.onChange(u))},null,544),[[Y,s.selectedAutoLoop]]),Ls,o("label",Is,[o("strong",{textContent:h("".concat(t.$t("actions.auto_play_next_video"),":"))},null,8,Es)]),g(o("input",{id:"chkAutoPlay","onUpdate:modelValue":e[10]||(e[10]=u=>s.selectedAutoPlay=u),class:"ml-1.5",type:"checkbox",onChange:e[11]||(e[11]=u=>i.onChange(u))},null,544),[[Y,s.selectedAutoPlay]]),Vs,o("div",$s,[o("div",Ms,[(F=s.comments)!=null&&F.disabled?f("",!0):(l(),d("button",{key:0,class:"btn mb-2",onClick:e[12]||(e[12]=(...u)=>i.toggleComments&&i.toggleComments(...u)),textContent:h("".concat(t.$t(s.showComments?"actions.minimize_comments":"actions.show_comments")," (").concat(t.numberFormat((W=s.comments)==null?void 0:W.commentCount),")"))},null,8,Ds))]),s.showComments?s.comments?s.comments.disabled?(l(),d("div",Us,[g(o("p",Ns,null,512),[[S,"comment.disabled"]])])):(l(),d("div",qs,[(l(!0),d(C,null,A(s.comments.comments,u=>(l(),P(E,{key:u.commentId,comment:u,uploader:s.video.uploader,"uploader-avatar-url":s.video.uploaderAvatar,"video-id":i.getVideoId()},null,8,["comment","uploader","uploader-avatar-url","video-id"]))),128))],512)):(l(),d("div",Rs,[g(o("p",Bs,null,512),[[S,"comment.loading"]])])):(l(),d("div",As)),s.video?(l(),d("div",Hs,[s.playlist?(l(),P(j,{key:0,"playlist-id":s.playlistId,playlist:s.playlist,"selected-index":s.index,"prefer-listen":i.isListening},null,8,["playlist-id","playlist","selected-index","prefer-listen"])):f("",!0),g(o("a",{class:"btn mb-2",onClick:e[13]||(e[13]=u=>s.showRecs=!s.showRecs)},null,512),[[S,"actions.".concat(s.showRecs?"minimize_recommendations":"show_recommendations")]]),g(o("hr",null,null,512),[[O,s.showRecs]]),g(o("div",null,[(l(!0),d(C,null,A(s.video.relatedStreams,u=>(l(),P(T,{key:u.url,item:u,"prefer-listen":i.isListening,class:"mb-4",height:"94",width:"168"},null,8,["item","prefer-listen"]))),128))],512),[[O,s.showRecs]]),Fs])):f("",!0)])]}),_:1},8,["show-content"])],64)}const Zs=z(Nt,[["render",Ws]]);export{Zs as default};
//# sourceMappingURL=WatchVideo-iIex-qcf.js.map
