{"version":3,"file":"HistoryPage-legacy-BOpT6k4y.js","sources":["../../src/components/HistoryPage.vue"],"sourcesContent":["<template>\n    <h1 v-t=\"'titles.history'\" class=\"mb-3 text-center font-bold\" />\n\n    <div class=\"flex\">\n        <div class=\"flex flex-col gap-2 md:flex-row md:items-center\">\n            <button v-t=\"'actions.clear_history'\" class=\"btn\" @click=\"clearHistory\" />\n\n            <button v-t=\"'actions.export_to_json'\" class=\"btn\" @click=\"exportHistory\" />\n\n            <div class=\"ml-auto flex items-center gap-1\">\n                <SortingSelector by-key=\"watchedAt\" @apply=\"order => videos.sort(order)\" />\n            </div>\n        </div>\n\n        <div class=\"ml-4 flex items-center\">\n            <input id=\"autoDelete\" v-model=\"autoDeleteHistory\" type=\"checkbox\" @change=\"onChange\" />\n            <label v-t=\"'actions.delete_automatically'\" class=\"ml-2\" for=\"autoDelete\" />\n            <select v-model=\"autoDeleteDelayHours\" class=\"select ml-3 pl-3\" @change=\"onChange\">\n                <option v-t=\"{ path: 'info.hours', args: { amount: '1' } }\" value=\"1\" />\n                <option v-t=\"{ path: 'info.hours', args: { amount: '3' } }\" value=\"3\" />\n                <option v-t=\"{ path: 'info.hours', args: { amount: '6' } }\" value=\"6\" />\n                <option v-t=\"{ path: 'info.hours', args: { amount: '12' } }\" value=\"12\" />\n                <option v-t=\"{ path: 'info.days', args: { amount: '1' } }\" value=\"24\" />\n                <option v-t=\"{ path: 'info.days', args: { amount: '3' } }\" value=\"72\" />\n                <option v-t=\"{ path: 'info.weeks', args: { amount: '1' } }\" value=\"168\" />\n                <option v-t=\"{ path: 'info.weeks', args: { amount: '3' } }\" value=\"336\" />\n                <option v-t=\"{ path: 'info.months', args: { amount: '1' } }\" value=\"672\" />\n                <option v-t=\"{ path: 'info.months', args: { amount: '2' } }\" value=\"1344\" />\n            </select>\n        </div>\n    </div>\n\n    <hr />\n\n    <div class=\"video-grid\">\n        <VideoItem v-for=\"video in videos\" :key=\"video.url\" :item=\"video\" />\n    </div>\n\n    <br />\n</template>\n\n<script>\nimport VideoItem from \"./VideoItem.vue\";\nimport SortingSelector from \"./SortingSelector.vue\";\n\nexport default {\n    components: {\n        VideoItem,\n        SortingSelector,\n    },\n    data() {\n        return {\n            videos: [],\n            autoDeleteHistory: false,\n            autoDeleteDelayHours: \"24\",\n        };\n    },\n    mounted() {\n        this.autoDeleteHistory = this.getPreferenceBoolean(\"autoDeleteWatchHistory\", false);\n        this.autoDeleteDelayHours = this.getPreferenceString(\"autoDeleteWatchHistoryDelayHours\", \"24\");\n\n        (async () => {\n            if (window.db && this.getPreferenceBoolean(\"watchHistory\", false)) {\n                var tx = window.db.transaction(\"watch_history\", \"readwrite\");\n                var store = tx.objectStore(\"watch_history\");\n                const cursorRequest = store.index(\"watchedAt\").openCursor(null, \"prev\");\n                cursorRequest.onsuccess = e => {\n                    const cursor = e.target.result;\n                    if (cursor) {\n                        const video = cursor.value;\n                        if (this.videos.length < 1000) cursor.continue();\n                        if (!this.shouldRemoveVideo(video)) {\n                            this.videos.push({\n                                url: \"/watch?v=\" + video.videoId,\n                                title: video.title,\n                                uploaderName: video.uploaderName,\n                                uploaderUrl: video.uploaderUrl,\n                                duration: video.duration,\n                                thumbnail: video.thumbnail,\n                                watchedAt: video.watchedAt,\n                                watched: true,\n                                currentTime: video.currentTime,\n                            });\n                        } else {\n                            store.delete(video.videoId);\n                        }\n                    }\n                };\n            }\n        })();\n    },\n    activated() {\n        document.title = \"Watch History - Piped\";\n    },\n    methods: {\n        clearHistory() {\n            if (window.db) {\n                var tx = window.db.transaction(\"watch_history\", \"readwrite\");\n                var store = tx.objectStore(\"watch_history\");\n                store.clear();\n            }\n            this.videos = [];\n        },\n        exportHistory() {\n            const dateStr = new Date().toISOString().split(\".\")[0];\n            let json = {\n                format: \"Piped\",\n                version: 1,\n                playlists: [\n                    {\n                        name: `Piped History ${dateStr}`,\n                        type: \"history\",\n                        visibility: \"private\",\n                        videos: this.videos.map(video => \"https://youtube.com\" + video.url),\n                    },\n                ],\n            };\n            this.download(JSON.stringify(json), `piped_history_${dateStr}.json`, \"application/json\");\n        },\n        onChange() {\n            this.setPreference(\"autoDeleteWatchHistory\", this.autoDeleteHistory);\n            this.setPreference(\"autoDeleteWatchHistoryDelayHours\", this.autoDeleteDelayHours);\n        },\n        shouldRemoveVideo(video) {\n            if (!this.autoDeleteHistory) return false;\n            // convert from hours to milliseconds\n            let maximumTimeDiff = Number(this.autoDeleteDelayHours) * 60 * 60 * 1000;\n            return Date.now() - video.watchedAt > maximumTimeDiff;\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","components","VideoItem","SortingSelector","data","videos","autoDeleteHistory","autoDeleteDelayHours","mounted","this","getPreferenceBoolean","getPreferenceString","window","db","store","transaction","objectStore","index","openCursor","onsuccess","e","cursor","target","result","video","value","length","continue","shouldRemoveVideo","delete","videoId","push","url","title","uploaderName","uploaderUrl","duration","thumbnail","watchedAt","watched","currentTime","activated","document","methods","clearHistory","clear","exportHistory","dateStr","Date","toISOString","split","json","format","version","playlists","name","type","visibility","map","download","JSON","stringify","onChange","setPreference","maximumTimeDiff","Number","now","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","for","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_createElementVNode","_hoisted_18","_openBlock","_createElementBlock","_Fragment","_withDirectives","onClick","$options","args","_createVNode","_component_SortingSelector","onApply","order","$data","sort","id","_cache","$event","_hoisted_6","path","amount","_hoisted_17","_renderList","_createBlock","_component_VideoItem","key","item","_hoisted_19"],"mappings":"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"}