{"version":3,"file":"SearchResults-C-VPtxqo.js","sources":["../../src/components/SearchResults.vue"],"sourcesContent":["<template>\n    <h1 class=\"my-2 text-center\" v-text=\"$route.query.search_query\" />\n\n    <label for=\"ddlSearchFilters\">\n        <strong v-text=\"`${$t('actions.filter')}:`\" />\n    </label>\n    <select id=\"ddlSearchFilters\" v-model=\"selectedFilter\" default=\"all\" class=\"select w-auto\" @change=\"updateFilter()\">\n        <option v-for=\"filter in availableFilters\" :key=\"filter\" v-t=\"`search.${filter}`\" :value=\"filter\" />\n    </select>\n\n    <hr />\n\n    <div v-if=\"results && results.corrected\">\n        <i18n-t keypath=\"search.did_you_mean\" tag=\"div\" class=\"text-lg\">\n            <router-link :to=\"{ name: 'SearchResults', query: { search_query: results.suggestion } }\">\n                <em v-text=\"results.suggestion\" />\n            </router-link>\n        </i18n-t>\n    </div>\n\n    <LoadingIndicatorPage :show-content=\"results != null && results.items?.length\" class=\"video-grid\">\n        <template v-for=\"result in results.items\" :key=\"result.url\">\n            <ContentItem :item=\"result\" height=\"94\" width=\"168\" />\n        </template>\n    </LoadingIndicatorPage>\n</template>\n\n<script>\nimport ContentItem from \"./ContentItem.vue\";\nimport LoadingIndicatorPage from \"./LoadingIndicatorPage.vue\";\n\nexport default {\n    components: {\n        ContentItem,\n        LoadingIndicatorPage,\n    },\n    data() {\n        return {\n            results: null,\n            availableFilters: [\n                \"all\",\n                \"videos\",\n                \"channels\",\n                \"playlists\",\n                \"music_songs\",\n                \"music_videos\",\n                \"music_albums\",\n                \"music_playlists\",\n                \"music_artists\",\n            ],\n            selectedFilter: this.$route.query.filter ?? \"all\",\n        };\n    },\n    mounted() {\n        if (this.handleRedirect()) return;\n        this.updateResults();\n        this.saveQueryToHistory();\n    },\n    updated() {\n        if (this.$route.query.search_query !== undefined) {\n            document.title = this.$route.query.search_query + \" - Piped\";\n        }\n    },\n    activated() {\n        this.handleRedirect();\n        window.addEventListener(\"scroll\", this.handleScroll);\n    },\n    deactivated() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    unmounted() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    methods: {\n        async fetchResults() {\n            return await await this.fetchJson(this.apiUrl() + \"/search\", {\n                q: this.$route.query.search_query,\n                filter: this.$route.query.filter ?? \"all\",\n            });\n        },\n        async updateResults() {\n            document.title = this.$route.query.search_query + \" - Piped\";\n            this.results = this.fetchResults().then(json => {\n                this.results = json;\n                this.updateWatched(this.results.items);\n            });\n        },\n        updateFilter() {\n            this.$router.replace({\n                query: {\n                    search_query: this.$route.query.search_query,\n                    filter: this.selectedFilter,\n                },\n            });\n        },\n        handleScroll() {\n            if (this.loading || !this.results || !this.results.nextpage) return;\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - window.innerHeight) {\n                this.loading = true;\n                this.fetchJson(this.apiUrl() + \"/nextpage/search\", {\n                    nextpage: this.results.nextpage,\n                    q: this.$route.query.search_query,\n                    filter: this.$route.query.filter ?? \"all\",\n                }).then(json => {\n                    this.results.nextpage = json.nextpage;\n                    this.results.id = json.id;\n                    this.loading = false;\n                    json.items.map(stream => this.results.items.push(stream));\n                });\n            }\n        },\n        handleRedirect() {\n            const query = this.$route.query.search_query;\n            const url =\n                /(?:http(?:s)?:\\/\\/)?(?:www\\.)?youtube\\.com(\\/[/a-zA-Z0-9_?=&-]*)/gm.exec(query)?.[1] ??\n                /(?:http(?:s)?:\\/\\/)?(?:www\\.)?youtu\\.be\\/(?:watch\\?v=)?([/a-zA-Z0-9_?=&-]*)/gm\n                    .exec(query)?.[1]\n                    .replace(/^/, \"/watch?v=\");\n            if (url) {\n                this.$router.push(url);\n                return true;\n            }\n        },\n        saveQueryToHistory() {\n            if (!this.getPreferenceBoolean(\"searchHistory\", false)) return;\n            const query = this.$route.query.search_query;\n            if (!query) return;\n            const searchHistory = JSON.parse(localStorage.getItem(\"search_history\")) ?? [];\n            if (searchHistory.includes(query)) {\n                const index = searchHistory.indexOf(query);\n                searchHistory.splice(index, 1);\n            }\n            searchHistory.unshift(query);\n            if (searchHistory.length > 10) searchHistory.shift();\n            localStorage.setItem(\"search_history\", JSON.stringify(searchHistory));\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","ContentItem","LoadingIndicatorPage","_a","json","stream","query","url","_c","_b","searchHistory","index","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_createElementVNode","_hoisted_7","_openBlock","_createElementBlock","_Fragment","_toDisplayString","_ctx","_cache","$event","$data","$options","_renderList","filter","_hoisted_5","_hoisted_6","_createVNode","_component_i18n_t","_withCtx","_component_router_link","_createCommentVNode","_component_LoadingIndicatorPage","result","_createBlock","_component_ContentItem"],"mappings":"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"}