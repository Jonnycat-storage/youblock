System.register(["./VideoItem-legacy-DDmFzm8y.js","./SortingSelector-legacy-_Zk7orG_.js","./index-legacy-CmTDz3X_.js","./ModalComponent-legacy-BmTvlHoT.js","./CreatePlaylistModal-legacy-Bg0tm0yq.js","./ConfirmModal-legacy-CnRD7ob6.js"],(function(e,t){"use strict";var o,l,a,n,s,i,r,u,c,d,h,y,p,m,g;return{setters:[e=>{o=e.V},e=>{l=e._},e=>{a=e.a,n=e.c,s=e.w,i=e.b,r=e.d,u=e.k,c=e.v,d=e.F,h=e.f,y=e.r,p=e.h,m=e.o,g=e.g},null,null,null],execute:function(){const t={components:{VideoItem:o,SortingSelector:l},data:()=>({videos:[],autoDeleteHistory:!1,autoDeleteDelayHours:"24"}),mounted(){this.autoDeleteHistory=this.getPreferenceBoolean("autoDeleteWatchHistory",!1),this.autoDeleteDelayHours=this.getPreferenceString("autoDeleteWatchHistoryDelayHours","24"),(async()=>{if(window.db&&this.getPreferenceBoolean("watchHistory",!1)){var e=window.db.transaction("watch_history","readwrite").objectStore("watch_history");e.index("watchedAt").openCursor(null,"prev").onsuccess=t=>{const o=t.target.result;if(o){const t=o.value;this.videos.length<1e3&&o.continue(),this.shouldRemoveVideo(t)?e.delete(t.videoId):this.videos.push({url:"/watch?v="+t.videoId,title:t.title,uploaderName:t.uploaderName,uploaderUrl:t.uploaderUrl,duration:t.duration,thumbnail:t.thumbnail,watchedAt:t.watchedAt,watched:!0,currentTime:t.currentTime})}}}})()},activated(){document.title="Watch History - Piped"},methods:{clearHistory(){window.db&&window.db.transaction("watch_history","readwrite").objectStore("watch_history").clear(),this.videos=[]},exportHistory(){const e=(new Date).toISOString().split(".")[0];let t={format:"Piped",version:1,playlists:[{name:`Piped History ${e}`,type:"history",visibility:"private",videos:this.videos.map((e=>"https://youtube.com"+e.url))}]};this.download(JSON.stringify(t),`piped_history_${e}.json`,"application/json")},onChange(){this.setPreference("autoDeleteWatchHistory",this.autoDeleteHistory),this.setPreference("autoDeleteWatchHistoryDelayHours",this.autoDeleteDelayHours)},shouldRemoveVideo(e){if(!this.autoDeleteHistory)return!1;let t=60*Number(this.autoDeleteDelayHours)*60*1e3;return Date.now()-e.watchedAt>t}}},v={class:"mb-3 text-center font-bold"},f={class:"flex"},w={class:"flex flex-col gap-2 md:flex-row md:items-center"},D={class:"ml-auto flex items-center gap-1"},H={class:"ml-4 flex items-center"},b={class:"ml-2",for:"autoDelete"},x={value:"1"},C={value:"3"},S={value:"6"},j={value:"12"},_={value:"24"},P={value:"72"},k={value:"168"},V={value:"336"},A={value:"672"},I={value:"1344"},W=i("hr",null,null,-1),M={class:"video-grid"},N=i("br",null,null,-1);e("default",a(t,[["render",function(e,t,o,l,a,U){const B=y("SortingSelector"),J=y("VideoItem"),O=p("t");return m(),n(d,null,[s(i("h1",v,null,512),[[O,"titles.history"]]),i("div",f,[i("div",w,[s(i("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>U.clearHistory&&U.clearHistory(...e))},null,512),[[O,"actions.clear_history"]]),s(i("button",{class:"btn",onClick:t[1]||(t[1]=(...e)=>U.exportHistory&&U.exportHistory(...e))},null,512),[[O,"actions.export_to_json"]]),i("div",D,[r(B,{"by-key":"watchedAt",onApply:t[2]||(t[2]=e=>a.videos.sort(e))})])]),i("div",H,[s(i("input",{id:"autoDelete","onUpdate:modelValue":t[3]||(t[3]=e=>a.autoDeleteHistory=e),type:"checkbox",onChange:t[4]||(t[4]=(...e)=>U.onChange&&U.onChange(...e))},null,544),[[u,a.autoDeleteHistory]]),s(i("label",b,null,512),[[O,"actions.delete_automatically"]]),s(i("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.autoDeleteDelayHours=e),class:"select ml-3 pl-3",onChange:t[6]||(t[6]=(...e)=>U.onChange&&U.onChange(...e))},[s(i("option",x,null,512),[[O,{path:"info.hours",args:{amount:"1"}}]]),s(i("option",C,null,512),[[O,{path:"info.hours",args:{amount:"3"}}]]),s(i("option",S,null,512),[[O,{path:"info.hours",args:{amount:"6"}}]]),s(i("option",j,null,512),[[O,{path:"info.hours",args:{amount:"12"}}]]),s(i("option",_,null,512),[[O,{path:"info.days",args:{amount:"1"}}]]),s(i("option",P,null,512),[[O,{path:"info.days",args:{amount:"3"}}]]),s(i("option",k,null,512),[[O,{path:"info.weeks",args:{amount:"1"}}]]),s(i("option",V,null,512),[[O,{path:"info.weeks",args:{amount:"3"}}]]),s(i("option",A,null,512),[[O,{path:"info.months",args:{amount:"1"}}]]),s(i("option",I,null,512),[[O,{path:"info.months",args:{amount:"2"}}]])],544),[[c,a.autoDeleteDelayHours]])])]),W,i("div",M,[(m(!0),n(d,null,h(a.videos,(e=>(m(),g(J,{key:e.url,item:e},null,8,["item"])))),128))]),N],64)}]]))}}}));
//# sourceMappingURL=HistoryPage-legacy-BOpT6k4y.js.map
