{"version":3,"file":"SearchResults-legacy-CuHR1ZCZ.js","sources":["../../src/components/SearchResults.vue"],"sourcesContent":["<template>\n    <h1 class=\"my-2 text-center\" v-text=\"$route.query.search_query\" />\n\n    <label for=\"ddlSearchFilters\">\n        <strong v-text=\"`${$t('actions.filter')}:`\" />\n    </label>\n    <select id=\"ddlSearchFilters\" v-model=\"selectedFilter\" default=\"all\" class=\"select w-auto\" @change=\"updateFilter()\">\n        <option v-for=\"filter in availableFilters\" :key=\"filter\" v-t=\"`search.${filter}`\" :value=\"filter\" />\n    </select>\n\n    <hr />\n\n    <div v-if=\"results && results.corrected\">\n        <i18n-t keypath=\"search.did_you_mean\" tag=\"div\" class=\"text-lg\">\n            <router-link :to=\"{ name: 'SearchResults', query: { search_query: results.suggestion } }\">\n                <em v-text=\"results.suggestion\" />\n            </router-link>\n        </i18n-t>\n    </div>\n\n    <LoadingIndicatorPage :show-content=\"results != null && results.items?.length\" class=\"video-grid\">\n        <template v-for=\"result in results.items\" :key=\"result.url\">\n            <ContentItem :item=\"result\" height=\"94\" width=\"168\" />\n        </template>\n    </LoadingIndicatorPage>\n</template>\n\n<script>\nimport ContentItem from \"./ContentItem.vue\";\nimport LoadingIndicatorPage from \"./LoadingIndicatorPage.vue\";\n\nexport default {\n    components: {\n        ContentItem,\n        LoadingIndicatorPage,\n    },\n    data() {\n        return {\n            results: null,\n            availableFilters: [\n                \"all\",\n                \"videos\",\n                \"channels\",\n                \"playlists\",\n                \"music_songs\",\n                \"music_videos\",\n                \"music_albums\",\n                \"music_playlists\",\n                \"music_artists\",\n            ],\n            selectedFilter: this.$route.query.filter ?? \"all\",\n        };\n    },\n    mounted() {\n        if (this.handleRedirect()) return;\n        this.updateResults();\n        this.saveQueryToHistory();\n    },\n    updated() {\n        if (this.$route.query.search_query !== undefined) {\n            document.title = this.$route.query.search_query + \" - Piped\";\n        }\n    },\n    activated() {\n        this.handleRedirect();\n        window.addEventListener(\"scroll\", this.handleScroll);\n    },\n    deactivated() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    unmounted() {\n        window.removeEventListener(\"scroll\", this.handleScroll);\n    },\n    methods: {\n        async fetchResults() {\n            return await await this.fetchJson(this.apiUrl() + \"/search\", {\n                q: this.$route.query.search_query,\n                filter: this.$route.query.filter ?? \"all\",\n            });\n        },\n        async updateResults() {\n            document.title = this.$route.query.search_query + \" - Piped\";\n            this.results = this.fetchResults().then(json => {\n                this.results = json;\n                this.updateWatched(this.results.items);\n            });\n        },\n        updateFilter() {\n            this.$router.replace({\n                query: {\n                    search_query: this.$route.query.search_query,\n                    filter: this.selectedFilter,\n                },\n            });\n        },\n        handleScroll() {\n            if (this.loading || !this.results || !this.results.nextpage) return;\n            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - window.innerHeight) {\n                this.loading = true;\n                this.fetchJson(this.apiUrl() + \"/nextpage/search\", {\n                    nextpage: this.results.nextpage,\n                    q: this.$route.query.search_query,\n                    filter: this.$route.query.filter ?? \"all\",\n                }).then(json => {\n                    this.results.nextpage = json.nextpage;\n                    this.results.id = json.id;\n                    this.loading = false;\n                    json.items.map(stream => this.results.items.push(stream));\n                });\n            }\n        },\n        handleRedirect() {\n            const query = this.$route.query.search_query;\n            const url =\n                /(?:http(?:s)?:\\/\\/)?(?:www\\.)?youtube\\.com(\\/[/a-zA-Z0-9_?=&-]*)/gm.exec(query)?.[1] ??\n                /(?:http(?:s)?:\\/\\/)?(?:www\\.)?youtu\\.be\\/(?:watch\\?v=)?([/a-zA-Z0-9_?=&-]*)/gm\n                    .exec(query)?.[1]\n                    .replace(/^/, \"/watch?v=\");\n            if (url) {\n                this.$router.push(url);\n                return true;\n            }\n        },\n        saveQueryToHistory() {\n            if (!this.getPreferenceBoolean(\"searchHistory\", false)) return;\n            const query = this.$route.query.search_query;\n            if (!query) return;\n            const searchHistory = JSON.parse(localStorage.getItem(\"search_history\")) ?? [];\n            if (searchHistory.includes(query)) {\n                const index = searchHistory.indexOf(query);\n                searchHistory.splice(index, 1);\n            }\n            searchHistory.unshift(query);\n            if (searchHistory.length > 10) searchHistory.shift();\n            localStorage.setItem(\"search_history\", JSON.stringify(searchHistory));\n        },\n    },\n};\n</script>\n"],"names":["_sfc_main","components","ContentItem","LoadingIndicatorPage","data","results","availableFilters","selectedFilter","this","$route","query","filter","mounted","handleRedirect","updateResults","saveQueryToHistory","updated","undefined","search_query","document","title","activated","window","addEventListener","handleScroll","deactivated","removeEventListener","unmounted","methods","fetchResults","fetchJson","apiUrl","q","then","json","updateWatched","items","updateFilter","$router","replace","loading","nextpage","innerHeight","scrollY","body","offsetHeight","id","map","stream","push","url","exec","getPreferenceBoolean","searchHistory","JSON","parse","localStorage","getItem","includes","index","indexOf","splice","unshift","length","shift","setItem","stringify","_hoisted_1","_hoisted_2","for","_hoisted_3","_hoisted_4","_createElementVNode","key","_hoisted_7","_openBlock","_createElementBlock","_Fragment","class","textContent","_toDisplayString","_ctx","$t","_cache","$event","$data","default","onChange","$options","_renderList","value","_hoisted_5","corrected","_hoisted_6","_createVNode","_component_i18n_t","keypath","tag","_withCtx","_component_router_link","to","name","suggestion","_","_createCommentVNode","_component_LoadingIndicatorPage","result","_createBlock","_component_ContentItem","item","height","width"],"mappings":"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"}